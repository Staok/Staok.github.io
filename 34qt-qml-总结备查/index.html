<!DOCTYPE html>
<html lang="">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>QT &amp; QML 总结备查 - 欢迎来到 瞰百Staok</title><meta name="Description" content="QT &amp; QML 总结备查"><meta property="og:title" content="QT &amp; QML 总结备查" />
<meta property="og:description" content="QT &amp; QML 总结备查" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://staok.github.io/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2026-02-10T09:15:14+08:00" />
<meta property="article:modified_time" content="2025-02-10T09:15:14+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="QT &amp; QML 总结备查"/>
<meta name="twitter:description" content="QT &amp; QML 总结备查"/>
<meta name="application-name" content="瞰百Staok">
<meta name="apple-mobile-web-app-title" content="瞰百Staok"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://staok.github.io/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/" /><link rel="prev" href="https://staok.github.io/35lvgl-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/" /><link rel="next" href="https://staok.github.io/33tia%E5%BC%B1%E7%94%B5%E6%B5%81%E6%B5%8B%E9%87%8F%E6%8E%AA%E6%96%BD%E5%92%8C%E7%BB%8F%E9%AA%8C%E6%B1%87%E6%80%BB/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "QT \u0026 QML 总结备查",
        "inLanguage": "",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/staok.github.io\/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/staok.github.io\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "QT, GUI","wordcount":  26047 ,
        "url": "https:\/\/staok.github.io\/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5\/","datePublished": "2026-02-10T09:15:14+08:00","dateModified": "2025-02-10T09:15:14+08:00","publisher": {
            "@type": "Organization",
            "name": "Staok","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/staok.github.io\/images\/avatar.png",
                    "width":  404 ,
                    "height":  392 
                }},"author": {
                "@type": "Person",
                "name": "Staok"
            },"description": "QT \u0026 QML 总结备查"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="欢迎来到 瞰百Staok"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="欢迎来到 瞰百Staok"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">QT &amp; QML 总结备查</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/Staok" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Staok</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E9%9A%8F%E6%9C%BA%E6%8A%80%E6%9C%AF%E6%83%85%E6%8A%A5/"><i class="far fa-folder fa-fw"></i>随机技术情报</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2026-02-10">2026-02-10</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 26047 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 52 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#常看常新">常看常新</a>
      <ul>
        <li><a href="#qt--qtquick-的学习">Qt \ QtQuick 的学习</a></li>
        <li><a href="#优秀开源参考">优秀开源参考</a></li>
        <li><a href="#misc">MISC</a></li>
        <li><a href="#qt-和-各个组件-开源协议">QT 和 各个组件 开源协议</a></li>
      </ul>
    </li>
    <li><a href="#前置信息">前置信息</a>
      <ul>
        <li><a href="#最佳实践--性能优化--技巧">最佳实践 / 性能优化 / 技巧</a></li>
        <li><a href="#用法查找">用法查找</a></li>
        <li><a href="#qt-creator--qml-tips">Qt Creator &amp; QML tips</a></li>
        <li><a href="#qml-辅助设计">QML 辅助设计</a></li>
        <li><a href="#qt-调试性能优化">Qt 调试&amp;性能优化</a></li>
        <li><a href="#测试--验证">测试 / 验证</a></li>
      </ul>
    </li>
    <li><a href="#qt-qml-常用控件总结备查--俯瞰">Qt QML 常用控件总结备查 / 俯瞰</a>
      <ul>
        <li><a href="#qtquick">QtQuick</a></li>
        <li><a href="#qtquickwindow">QtQuick.Window</a></li>
        <li><a href="#qtqml">QtQml</a></li>
        <li><a href="#qtquicklayouts">QtQuick.Layouts</a></li>
        <li><a href="#qtquickcontrols">QtQuick.Controls</a></li>
        <li><a href="#qtquickdialogs">QtQuick.Dialogs</a></li>
        <li><a href="#other">Other</a></li>
      </ul>
    </li>
    <li><a href="#实用三方组件收集">实用三方组件收集</a></li>
    <li><a href="#常用基础--经验">常用基础 &amp; 经验</a>
      <ul>
        <li><a href="#c-端-显示-qml-文件">C++ 端 显示 Qml 文件</a></li>
        <li><a href="#qml-基础语法">QML 基础语法</a></li>
        <li><a href="#qml-较全面的基础-api-介绍">QML 较全面的基础 API 介绍</a></li>
        <li><a href="#qml-中几种信号和槽">QML 中几种信号和槽</a></li>
        <li><a href="#c-实现-qt-的信号槽机制">C++ 实现 Qt 的信号槽机制</a></li>
        <li><a href="#qml-控件-id-作用域">QML 控件 ID 作用域</a></li>
        <li><a href="#qml-属性绑定和解绑">QML 属性绑定和解绑</a></li>
        <li><a href="#qml-与-c-相互调用">QML 与 C++ 相互调用</a>
          <ul>
            <li><a href="#qml-调用-c-类">QML 调用 C++ 类</a></li>
            <li><a href="#c-调用-qml">C++ 调用 QML</a></li>
          </ul>
        </li>
        <li><a href="#多语言--字体">多语言 &amp; 字体</a></li>
        <li><a href="#控件位置和排列设置">控件位置和排列设置</a></li>
      </ul>
    </li>
    <li><a href="#问题解决">问题解决</a>
      <ul>
        <li>
          <ul>
            <li><a href="#工程文件-pro-解析">工程文件 .pro 解析</a></li>
            <li><a href="#更新-qml-再运行">更新 qml 再运行</a></li>
            <li><a href="#qt-非阻塞处理机制qt-的-单线程循环-qeventloop-和-多线程-qthread-编程">Qt 非阻塞处理机制（Qt 的 单线程循环 QEventLoop 和 多线程 QThread 编程）</a></li>
            <li><a href="#子页面向父页面传参">子页面向父页面传参</a></li>
            <li><a href="#qml-圆角矩形-radius-clip-对子组件无效">QML 圆角矩形 radius clip 对子组件无效</a></li>
            <li><a href="#显示图片">显示图片</a></li>
            <li><a href="#qt-事件传播链--加事件过滤">QT 事件传播链 / 加事件过滤</a></li>
            <li><a href="#qml-附加属性">QML 附加属性</a></li>
            <li><a href="#ui-埋点">UI 埋点</a>
              <ul>
                <li><a href="#availability"><strong>Availability</strong></a></li>
              </ul>
            </li>
            <li><a href="#qt显示中文问题">Qt显示中文问题</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#具体控件积累">具体控件积累</a>
      <ul>
        <li><a href="#qt-实用类-集合">QT 实用类 集合</a>
          <ul>
            <li><a href="#qflags">QFlags</a></li>
            <li><a href="#qelapsedtimer">QElapsedTimer</a></li>
            <li><a href="#qasconst">qAsConst</a></li>
            <li><a href="#qsharedpointer">QSharedPointer</a></li>
            <li><a href="#qcache">QCache</a></li>
          </ul>
        </li>
        <li><a href="#qdebug-重定向">qDebug() 重定向</a></li>
        <li><a href="#获取自身-内存占用-和-cpu-使用率">获取自身 内存占用 和 CPU 使用率</a></li>
        <li><a href="#添加-icon-图标">添加 icon 图标</a></li>
        <li><a href="#mousearea--taphandler">MouseArea / TapHandler</a></li>
        <li><a href="#动态-创建--加载组件">动态 创建 / 加载组件</a></li>
        <li><a href="#listmodel--listview">ListModel &amp; ListView</a></li>
        <li><a href="#信息打印">信息打印</a></li>
        <li><a href="#模拟点击--随即点击">模拟点击 / 随即点击</a></li>
        <li><a href="#多页面切换">多页面切换</a></li>
        <li><a href="#qt-多线程">QT 多线程</a></li>
        <li><a href="#延时">延时</a></li>
        <li><a href="#文件读写">文件读写</a></li>
        <li><a href="#文件浏览">文件浏览</a></li>
        <li><a href="#网络">网络</a></li>
        <li><a href="#json-构造解析">Json 构造、解析</a></li>
        <li><a href="#颜色表示法">颜色表示法</a></li>
        <li><a href="#qt-定时器">qt 定时器</a></li>
        <li><a href="#qt-测量时间">qt 测量时间</a></li>
        <li><a href="#单击显示坐标">单击显示坐标</a></li>
        <li><a href="#多点触摸控件">多点触摸控件</a></li>
        <li><a href="#encodeuri">encodeURI()</a></li>
        <li><a href="#控件对应-c-原型">控件对应 C++ 原型</a></li>
        <li><a href="#键盘事件">键盘事件</a></li>
        <li><a href="#快捷键">快捷键</a></li>
        <li><a href="#输入组件--文本块显示">输入组件 / 文本块显示</a></li>
        <li><a href="#虚拟键盘">虚拟键盘</a></li>
        <li><a href="#读-excel-表格">读 Excel 表格</a></li>
        <li><a href="#调用-sqlite">调用 SQLite</a></li>
        <li><a href="#动画">动画</a></li>
        <li><a href="#绘图">绘图</a></li>
        <li><a href="#显示网页">显示网页</a></li>
        <li><a href="#程序打包">程序打包</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="qt--qml-总结备查">QT &amp; QML 总结备查</h1>
<p>首要注意，在桌面端开发QT可免费商用，而嵌入式端QT商用则收费。</p>
<p>各种 UI 库的总结和对比：</p>
<p><a href="https://github.com/Staok/Cpp-Learning/blob/main/C-C%2B%2B%e5%ae%9e%e7%94%a8%e5%ba%93%e5%a4%87%e6%9f%a5.md#ui" target="_blank" rel="noopener noreffer">Cpp-Learning/C-C++实用库备查.md at main · Staok/Cpp-Learning</a>。</p>
<p>文章所在 Github 仓库 <a href="https://github.com/Staok/QT-QML-Learning" target="_blank" rel="noopener noreffer">Staok/QT-QML-Learning: QT &amp; QML 总结备查文章</a> 会保持最新，其它地方的不会跟进。</p>
<h2 id="常看常新">常看常新</h2>
<p>QT 安装：网搜 Qt Creator 下载和安装即可。</p>
<p>编译器：对于 Win 上</p>
<ul>
<li>可以选择 mingw 等。可以用 msys2 包管理器 下载 gcc 包 并使用。</li>
<li>也可配置使用 msvc 编译器 和 调试器 <a href="https://blog.csdn.net/qq_40010218/article/details/124988210">https://blog.csdn.net/qq_40010218/article/details/124988210</a>。</li>
</ul>
<h3 id="qt--qtquick-的学习">Qt \ QtQuick 的学习</h3>
<ul>
<li>B站搜索即可</li>
<li>开源入门书籍，该仓库内积累了极其丰富的 Qt 开发经验
<ul>
<li><a href="https://github.com/feiyangqingyun/qtkaifajingyan">https://github.com/feiyangqingyun/qtkaifajingyan</a></li>
<li><a href="https://gitee.com/feiyangqingyun/qtkaifajingyan">https://gitee.com/feiyangqingyun/qtkaifajingyan</a></li>
<li>上面链接里面有不少 书籍 pdf，其中推荐的书，选择感兴趣的章节看：
<ul>
<li>Qml 详解，好《Qt Quick核心编程》</li>
<li>Quick 和 C++ 一块讲，前后端都有个了解，但是讲的比较生硬《QT5 编程入门》</li>
<li>C++ 基础，Qt 下 C++ API 详解，好《C++  Qt设计模式》</li>
<li>《从此乱码是路人》</li>
</ul>
</li>
</ul>
</li>
<li>入门系列 <a href="https://blog.csdn.net/qq_38880380/category_9592212.html">https://blog.csdn.net/qq_38880380/category_9592212.html</a></li>
<li>Qt 提供的组件 <a href="https://www.qt.io/product/features">https://www.qt.io/product/features</a></li>
<li>Qt 测试相关 <a href="https://www.qt.io/product/quality-assurance">https://www.qt.io/product/quality-assurance</a>，GUI 测试、代码覆盖率、静态检测等。</li>
<li>Qt 对嵌入式的支持 <a href="https://doc.qt.io/embedded.html">https://doc.qt.io/embedded.html</a>
<ul>
<li>MCU <a href="https://doc.qt.io/QtForMCUs-2.5/">https://doc.qt.io/QtForMCUs-2.5/</a></li>
<li>嵌入式 Linux，即 Qt for Device Creation <a href="https://doc.qt.io/Boot2Qt-5.15/">https://doc.qt.io/Boot2Qt-5.15/</a></li>
<li>QtEmbedded，经查，这是 Qt 4.x 时代的东西，对于 Qt 5.x、6.x，目前已经被 Qt for Device Creation 取代，即在 配置 qt 库的时候指定交叉编译器 <a href="https://doc.qt.io/qt-5/configure-linux-device.html">https://doc.qt.io/qt-5/configure-linux-device.html</a>。</li>
</ul>
</li>
</ul>
<p>Qt Designer 教程：</p>
<ul>
<li>B站搜索即可</li>
</ul>
<h3 id="优秀开源参考">优秀开源参考</h3>
<p>下面列出优秀开源仓库，分别列出 Github 和 Gitee 链接；
包含众多Qt组件使用案例可参考借鉴。</p>
<ul>
<li>
<p>Qt 中文文档
<a href="https://github.com/QtDocumentCN/QtDocumentCN">https://github.com/QtDocumentCN/QtDocumentCN</a></p>
<p>​	https://gitee.com/cryfeifei/QtDocumentCN</p>
</li>
<li>
<p>Qml 丰富组件使用示例库：</p>
<p>​	https://github.com/zhengtianzuo/QtQuickExamples</p>
<p>​	https://gitee.com/zhengtianzuo/QtQuickExamples</p>
</li>
<li>
<p>Qml 丰富使用例子</p>
<p>​	https://blog.51cto.com/u_12606971/category21.html</p>
<p>​	https://blog.51cto.com/u_12606971/category22.html</p>
</li>
<li>
<p>QtQuick/Qml基础库和示例：</p>
<p>​	https://github.com/jaredtao/TaoQuick</p>
<p>​	https://gitee.com/jaredtao/TaoQuick</p>
</li>
<li>
<p>Qml/C++小工具包</p>
<p>​	https://github.com/188080501/JQTools</p>
</li>
<li>
<p>Qt Widget 优秀参考：</p>
<p>开源的demo：</p>
<p>​	https://github.com/feiyangqingyun/QWidgetDemo</p>
<p>​	https://gitee.com/feiyangqingyun/QWidgetDemo</p>
<p>控件集合</p>
<p>​	https://github.com/feiyangqingyun/qucsdk</p>
<p>​	https://gitee.com/feiyangqingyun/QUCSDK</p>
<p>B站演示视频，众多例子开源可下载借用</p>
<p>​	https://space.bilibili.com/687803542/video</p>
<p>开源嵌入式QT组件</p>
<p>​	https://gitee.com/coffeeLVeris/qt_open_icon</p>
<p>编程语录</p>
<p>​	https://github.com/feiyangqingyun/bianchengyulu</p>
<p>​	https://gitee.com/feiyangqingyun/bianchengyulu</p>
<p>丰富使用例子</p>
<p>​	https://blog.51cto.com/u_12606971/category11/p_4</p>
<p>​	https://blog.51cto.com/u_12606971/category18.html</p>
</li>
</ul>
<h3 id="misc">MISC</h3>
<ul>
<li>
<p>Qt Widgets、QML、Qt Quick 的区别： <a href="https://waleon.blog.csdn.net/article/details/54141552">https://waleon.blog.csdn.net/article/details/54141552</a></p>
</li>
<li>
<p>QML 编码约定： <a href="https://waleon.blog.csdn.net/article/details/60964759">https://waleon.blog.csdn.net/article/details/60964759</a></p>
</li>
<li>
<p>Qt 资料大全：（内含编码风格、论坛） <a href="https://waleon.blog.csdn.net/article/details/51752029">https://waleon.blog.csdn.net/article/details/51752029</a></p>
</li>
</ul>
<p>在线源码查看 <a href="https://codebrowser.dev/qt5/">https://codebrowser.dev/qt5/</a></p>
<h3 id="qt-和-各个组件-开源协议">QT 和 各个组件 开源协议</h3>
<p>简述 各种版本的QT（专业版、商业版、社区版） 用于 PC软件、设备 等 的条件：</p>
<p><a href="https://www.qt.io/licensing">https://www.qt.io/licensing</a></p>
<p>有提到，社区版 用于 PC软件 或 设备 上，必须遵守 <a href="https://www.gnu.org/licenses/lgpl-3.0.en.html" target="_blank" rel="noopener noreffer">(L)GPL</a>。</p>
<p><a href="https://doc.qt.io/qt-5/qtcore-index.html#licenses-and-attributions">https://doc.qt.io/qt-5/qtcore-index.html#licenses-and-attributions</a></p>
<blockquote>
<p>Qt Core 可根据商业许可获得<a href="http://www.qt.io/about-us/" target="_blank" rel="noopener noreffer">The Qt Company</a>。此外，它可以在自由软件许可下使用。从 Qt 5.4 开始，这些自由软件许可证是<a href="http://www.gnu.org/licenses/lgpl-3.0.html" target="_blank" rel="noopener noreffer">GNU Lesser General Public License, version 3</a>， 或者<a href="http://www.gnu.org/licenses/gpl-2.0.html" target="_blank" rel="noopener noreffer">GNU General Public License, version 2</a>。看<a href="https://doc.qt.io/qt-5/licensing.html" target="_blank" rel="noopener noreffer">Qt Licensing</a>了解更多详情。</p>
</blockquote>
<p>各组件 的 使用许可 列表（只有 专业版 和 商业版 对于 PC软件 和 设备 上使用的说明）</p>
<p><a href="https://www.qt.io/terms-conditions/qt-dev-framework/exhibit-1">https://www.qt.io/terms-conditions/qt-dev-framework/exhibit-1</a></p>
<p>qt 各组件 下的使用的三方库的开源协议</p>
<p><a href="https://doc.qt.io/qt-5/licenses-used-in-qt.html">https://doc.qt.io/qt-5/licenses-used-in-qt.html</a></p>
<blockquote>
<p>GNU GPL（GNU通用公共许可证）和LGPL（Lesser GNU通用公共许可证）是一种常见的开源软件许可证。下面是对GPL2和LGPL3的简述以及它们之间的区别：</p>
<p>GNU GPL（GPL2）： GPL2是GNU GPL的第二版，它是自由软件基金会（FSF）发布的一种开源软件许可证。主要特点包括：</p>
<ol>
<li>自由传播：GPL2要求任何以GPL2许可的软件必须能够自由传播。用户可以复制、分发和修改被许可的软件，并且任何以GPL2许可的衍生作品也必须在相同的许可下分发。</li>
<li>源代码可用性：GPL2要求在分发和修改GPL2许可的软件时，必须提供相应的源代码，并允许接收者以GPL2的条件使用、修改和分发源代码。</li>
<li>程序和库的一致性：如果你将一个GPL2许可的库嵌入你的应用程序中，你的应用程序也必须以GPL2许可进行分发。这被称为&quot;传染性&quot;的特性。</li>
<li>版权声明：GPL2要求在软件中包含原始版权声明和GPL2许可文本。</li>
</ol>
<p>Lesser GNU GPL（LGPL3）： LGPL3是Lesser GNU通用公共许可证的第三版，也是由FSF发布的一种开源软件许可证。相对于GPL2，LGPL3更适用于库和框架的开源许可。其主要特点包括：</p>
<ol>
<li>动态链接：LGPL3允许将LGPL3许可的库与闭源应用程序进行动态链接，而不需要将应用程序的源代码公开。这使开发者能够使用LGPL3许可的库构建闭源商业产品。</li>
<li>版权声明：LGPL3要求在库中包含版权声明和LGPL3许可文本。如果修改了库的源代码，则还需要提供修改后的源代码。</li>
<li>衍生作品的许可：如果基于LGPL3许可的库创建了衍生作品，这些衍生作品也必须以LGPL3许可进行分发。</li>
</ol>
<p>区别： 主要的区别在于GPL2对于软件的传染性要求，而LGPL3则更加灵活，特别适用于库和框架。具体来说，区别包括：</p>
<ol>
<li>传染性：GPL2具有传染性，要求整个衍生作品遵循GPL2许可，而LGPL3相对较灵活，允许闭源应用程序与LGPL3许可的库进行动态链接。</li>
<li>动态链接：LGPL3允许将LGPL3许可的库动态链接到闭源应用程序中，而GPL2则将所有程序（包括应用程序和库）视为一个整体。</li>
<li>库和框架的适用性：LGPL3更适合作为库和框架的许可证，而GPL2主要用于完整的应用程序。</li>
</ol>
<p>需要特别注意的是，我提供的是简要概述，具体的许可证条款和法律解释可能更加详细和具体。如果您需要更具体的法律建议，请咨询专业的法律顾问或律师。</p>
</blockquote>
<h2 id="前置信息">前置信息</h2>
<h3 id="最佳实践--性能优化--技巧">最佳实践 / 性能优化 / 技巧</h3>
<p>Qt 文档 <code>Qt Overviews</code></p>
<blockquote>
<p>Qt Overviews</p>
<p>Qt features a wide range of different technologies. The following topics are key areas of functionality and can be used as a starting point for learning how to to get the most of Qt.</p>
<ul>
<li>
<p>Development Tools</p>
</li>
<li>
<p>User Interfaces</p>
</li>
<li>
<p>Core Internals</p>
</li>
<li>
<p>Data Storage</p>
</li>
<li>
<p>Multimedia</p>
</li>
<li>
<p>Networking and Connectivity</p>
</li>
<li>
<p>Graphics</p>
</li>
<li>
<p>Integrating Web Content</p>
</li>
<li>
<p>Mobile APIs</p>
</li>
<li>
<p>QML Applications</p>
</li>
<li>
<p>Scripting</p>
</li>
<li>
<p>Internationalization with Qt</p>
</li>
<li>
<p>Testing and Debugging</p>
</li>
<li>
<p>Porting from Qt 4</p>
</li>
</ul>
<p>Best Practices</p>
<p>These pages give guidance on how to use Qt technologies best to create applications that excel in usability and software design.</p>
<table>
<thead>
<tr>
<th>Accessibility</th>
<th>How to make your applications accessible to those with disabilities.</th>
</tr>
</thead>
<tbody>
<tr>
<td>Accessibility for Qt Quick Applications</td>
<td>How to make your applications accessible to those with disabilities.</td>
</tr>
<tr>
<td>Best Practices for QML and Qt Quick</td>
<td>Lists best practices for working with QML and Qt Quick</td>
</tr>
<tr>
<td>Books about GUI Design</td>
<td>Some recommended books about GUI design</td>
</tr>
<tr>
<td>Calling Qt Functions From Unix Signal Handlers</td>
<td>You can&rsquo;t. But don&rsquo;t despair, there is a way&hellip;</td>
</tr>
<tr>
<td>Coordinate System</td>
<td>Information about the coordinate system used by the paint system</td>
</tr>
<tr>
<td>Creating Custom Qt Types</td>
<td>How to create and register new types with Qt</td>
</tr>
<tr>
<td>Creating Shared Libraries</td>
<td>How to create shared libraries.</td>
</tr>
<tr>
<td>Creating and Using Components for Qt Designer</td>
<td>How to create and use custom widget plugins</td>
</tr>
<tr>
<td>Desktop Integration</td>
<td>Integrating with the user&rsquo;s desktop environment.</td>
</tr>
<tr>
<td>Exception Safety</td>
<td>A guide to exception safety in Qt.</td>
</tr>
<tr>
<td>How to Create Qt Plugins</td>
<td>A guide to creating plugins to extend Qt&rsquo;s applications and functionalities.</td>
</tr>
<tr>
<td>Implementing Atomic Operations</td>
<td>A guide to implementing atomic operations on new architectures.</td>
</tr>
<tr>
<td>Qt Test Tutorial</td>
<td>A short introduction to testing with Qt Test</td>
</tr>
<tr>
<td>Restoring a Window&rsquo;s Geometry</td>
<td>How to save  restore window geometry.</td>
</tr>
<tr>
<td>Rich Text Processing</td>
<td>An overview of Qt&rsquo;s rich text processing, editing and display features</td>
</tr>
<tr>
<td>Scalability</td>
<td>How to develop applications that scale well on devices with different screen configurations and UI conventions.</td>
</tr>
<tr>
<td>Session Management</td>
<td>How to do session management with Qt.</td>
</tr>
<tr>
<td>Setting the Application Icon</td>
<td>How to set your application&rsquo;s icon.</td>
</tr>
<tr>
<td>Standard Accelerator Keys</td>
<td>Recommended accelerator keys.</td>
</tr>
<tr>
<td>Timers</td>
<td>How to use Qt timers in your application</td>
</tr>
<tr>
<td>Using Qt D-Bus Adaptors</td>
<td>How to create and use DBus adaptors in Qt</td>
</tr>
</tbody>
</table>
</blockquote>
<p>QML 性能优化建议</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/617646961">https://zhuanlan.zhihu.com/p/617646961</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/617667595">https://zhuanlan.zhihu.com/p/617667595</a></li>
</ul>
<p>一些 QtQuick 开发技巧</p>
<p><a href="https://blog.csdn.net/qyvlik/article/details/51226005">https://blog.csdn.net/qyvlik/article/details/51226005</a></p>
<p>how-to-write-clean-qml-code</p>
<p><a href="https://scythe-studio.com/en/blog/how-to-write-clean-qml-code">https://scythe-studio.com/en/blog/how-to-write-clean-qml-code</a></p>
<p>有哪些机制，让 qml 更省内存</p>
<p>chatGPT</p>
<blockquote>
<p>在 Qt QML 中，可以采取一些机制和最佳实践，以降低内存使用，从而使你的应用程序更加节省内存。以下是一些可用的方法：</p>
<ul>
<li>
<p>图像和资源管理：使用适当的图像格式和尺寸。确保图像不过大，可以通过工具进行压缩和优化。将大型图像切成小块以进行懒加载，只加载在需要的时候。</p>
</li>
<li>
<p>资源管理：使用 Image 控件的 cache 属性来管理图像的缓存，根据需要禁用缓存，以节省内存。使用 Loader 控件来异步加载和卸载组件，从而减少一次性加载大量内容带来的内存开销。</p>
</li>
<li>
<p>垃圾回收和销毁对象：在不再需要的时候，手动销毁 QML 对象以释放内存。例如，通过调用 JavaScript 函数 destroy()，以及在需要时解除信号连接。使用 JavaScript 引擎的垃圾回收来清理不再使用的对象。</p>
</li>
<li>
<p>对象池：对于那些需要频繁创建和销毁的对象，可以实现对象池来重复使用这些对象，而不是频繁地创建和销毁它们。</p>
</li>
<li>
<p>内存优化的 QML 设计：避免创建过多的不必要的对象。设计你的 QML 代码以便在可能的情况下重用对象，而不是不断地创建新的实例。避免在循环中创建大量的对象，因为这可能会导致内存泄漏。</p>
</li>
<li>
<p>使用位图字体：如果可能的话，使用位图字体代替矢量字体。矢量字体可以产生大量的内存开销，特别是在大型文本块的情况下。</p>
</li>
<li>
<p>合理使用 C++ 与 QML 混合编程：在某些情况下，使用 C++ 编写性能敏感的代码，以降低内存和 CPU 开销。C++ 可以更好地控制内存管理。</p>
</li>
<li>
<p>监测内存使用：使用 Qt 的内存分析工具来监测内存使用情况，以找出可能的内存泄漏和瓶颈。</p>
</li>
<li>
<p>减少不必要的渲染：使用 visible 属性来控制哪些元素在屏幕上可见，以减少不必要的渲染。</p>
</li>
<li>
<p>定时清理：使用定时器来定期清理不再需要的对象和资源。</p>
</li>
</ul>
<p>总的来说，内存优化在 QML 中是一个综合性的工作，需要综合考虑你的应用程序的特定需求和限制。使用上述策略和实践来降低内存使用，可以提高应用程序的性能和稳定性。</p>
<p>除了上述提到的机制和最佳实践，以下是更多方法，可帮助降低 Qt QML 应用程序的内存占用：</p>
<ul>
<li>使用 ListModel 代替 JavaScript 数组：在处理大量数据时，使用 ListModel 作为数据模型，而不是普通的 JavaScript 数组。ListModel 可以更有效地管理数据并降低内存使用。</li>
<li>避免使用过多的不必要数据绑定：数据绑定是 QML 的强大特性，但滥用它可能导致内存占用增加。确保只在需要时进行数据绑定，避免不必要的信号和属性绑定。</li>
<li>使用 Repeater 控件：Repeater 控件允许你重复创建相似的元素，而无需为每个元素创建单独的实例。这可以减少内存占用。</li>
<li>使用 WorkerScript 进行异步计算：对于需要进行长时间计算的任务，可以将其放在 WorkerScript 中，以避免阻塞主线程并减少内存开销。</li>
<li>减少 JavaScript 对象的复杂性：简化和规范你的 JavaScript 对象结构，避免过于复杂的嵌套对象，以降低内存使用。</li>
<li>使用位运算或位图来管理状态：对于需要跟踪多个状态的场景，可以使用位运算或位图来更有效地管理状态信息，减少内存开销。</li>
<li>优化界面布局：避免使用过多不必要的布局元素，合理设计布局以减少布局元素的数量，从而减少内存占用。</li>
<li>使用虚拟滚动和分页加载：当处理大量数据时，实现虚拟滚动和分页加载，以便只加载和渲染当前可见区域的数据，而不是全部数据。</li>
<li>适度使用缓存：尽管可以在 QML 控件中禁用缓存，但在某些情况下启用缓存可以提高性能。根据具体情况权衡是否启用控件的缓存。</li>
<li>分析内存占用：使用 Qt Creator 或其他性能分析工具来分析内存占用，找出潜在的问题和内存泄漏，并对应用程序进行适当的优化。</li>
</ul>
<p>记住，内存优化通常需要在应用程序的开发周期中进行多次迭代和测试。根据应用程序的特定需求和性能要求，采取不同的策略和组合来降低内存占用。</p>
</blockquote>
<h3 id="用法查找">用法查找</h3>
<ol>
<li>
<p>在组件上按 F1 弹出帮助。</p>
</li>
<li>
<p>网搜具体控件的使用，CSDN、知乎等文章。</p>
</li>
<li>
<p>参考上面 “Qt 中文文档” Github 仓库里内容。浏览 MarkDown 文档用 Typora（网搜有和谐版）。</p>
</li>
<li>
<p>Qt Creator 自带帮助，目录文档：</p>
<p>All QML APIs by Module</p>
<p>All QML Basic Types</p>
<p>All QML Modules</p>
<p>All QML Types</p>
</li>
<li>
<p>下面给出“Qt Qml 控件总结”</p>
</li>
</ol>
<h3 id="qt-creator--qml-tips">Qt Creator &amp; QML tips</h3>
<p><strong>Qt Creator</strong></p>
<ul>
<li>编辑 QML 最好看着看实时效果来，用 QML Preview 一点点调就好。</li>
<li>在 “编辑” 界面进行主要工作，“设计” 界面可以对 .ui 或 .qml 编辑界面（对于qml/quick开发并不常用），“项目” 界面设置工具链。</li>
<li>在组件上按 F1 弹出帮助。</li>
<li>ctrl + f：当前文件搜索，可使用高级搜索。</li>
<li>ctrl + k：搜索文件。</li>
</ul>
<p><strong>Qml</strong></p>
<ul>
<li>
<p>每个页面文件中的文案，使用便利的数据结构（如 Qt 里的 ListModel）集中组织起来，并统一放到页面文件的最上方。</p>
<p>单个页面具有重复性的元素的（以行或列排列）使用动态显示组件（比如 Qt 的 ListView）。</p>
</li>
<li>
<p>qml 页面中的 自定义属性 可以都放到 QtObject（不可见控件，官方手册说很方便用于包裹一些杂物） 控件里面打包。</p>
</li>
<li>
<p>所有的 Qml Item 控件 最好都加上 Id 和 objectName 属性，二者同名即可，且最好是全局名字唯一，可以用 <code>属什么_是什么_做什么</code> 的规范来命名，比如 <code>page_rect_comp</code>，在 page（页面） 的 rect（矩形） 用来作为 comp（组件）。objectName 方便 C++ 端 寻找到该控件。</p>
</li>
<li>
<p>多使用 Item 对控件进行分组。当前控件或窗口捕获到 鼠标事件 或者 键盘事件 后，应该设置 相应的 mouse.accepted 为 true，再进行处理，防止事件（或者说信号）继续传播（给其它控件）。这个按需求来。</p>
</li>
<li>
<p>字数多的文本框，要加 width / maxWidth(ZText)，并且启用换行 wrap。</p>
</li>
<li>
<p>在 Text 或 Rectangle 等控件（不是所有控件）上 按下 ctrl + alt + space 则弹出快速设置这些 控件 的 弹窗。</p>
</li>
</ul>
<h3 id="qml-辅助设计">QML 辅助设计</h3>
<p>但目前还是手写 Qml 居多，推荐用 QML Preview 看实时效果</p>
<ul>
<li>
<p>figma：https://www.figma.com/。</p>
<p>​    <a href="https://www.bilibili.com/video/av931445067/">https://www.bilibili.com/video/av931445067/</a>。</p>
<p>​    <a href="https://www.bilibili.com/video/BV15e4y1d7E5/">https://www.bilibili.com/video/BV15e4y1d7E5/</a>。</p>
<p>​    <a href="https://edu.csdn.net/learn/30741/459042">https://edu.csdn.net/learn/30741/459042</a>。</p>
</li>
<li>
<p>及时设计 + CODE.FUN插件 导出 js 代码。</p>
<p>​    <a href="https://www.bilibili.com/video/BV1KB4y1n7mX/">https://www.bilibili.com/video/BV1KB4y1n7mX/</a>。</p>
<p>​    <a href="https://js.design/tutorial/63b4ec9d2bd11c40c496212c">https://js.design/tutorial/63b4ec9d2bd11c40c496212c</a>。</p>
</li>
<li>
<p>Qt Design Studio：可以图形化编辑 UI，也可以导入 figma 设计文件，然后导出 QML。</p>
<p>​    B站搜索相关教程：https://search.bilibili.com/all?keyword=Qt Design Studio。</p>
</li>
</ul>
<h3 id="qt-调试性能优化">Qt 调试&amp;性能优化</h3>
<ul>
<li>QT debug and performance
<ul>
<li>QT log redirection，可以通过 <code>InstallMessageHandler(QtMessageHandler handler)</code> 重定向 log 输出。</li>
<li>QLoggingCategory，使用 QLoggingCategory 过滤所需 log。</li>
<li>QT QML Profiler，Qt Creator 的 Analyze-&gt;QML Profiler，可视化监控程序运行全程，各项参数，调用函数，函数调用火焰图，对耗时的地方针对性优化。</li>
<li>QT performance，QT 官方对于提升性能的指导和建议：https://doc.qt.io/qt-5/qtquick-performance.html#common-interface-elements。</li>
</ul>
</li>
<li>根据 perf 抓取 qt 底层调用火焰图找出耗时API，热点函数，针对性优化，利用硬件进行加速。</li>
<li><a href="https://blog.csdn.net/qq_35865125/article/details/85867397">https://blog.csdn.net/qq_35865125/article/details/85867397</a>。</li>
</ul>
<h3 id="测试--验证">测试 / 验证</h3>
<p>官方质量保证工具：https://www.qt.io/zh-cn/product/testing-tools，https://www.qt.io/zh-cn/product/quality-assurance。</p>
<ul>
<li>
<p>Squish，GUI自动化测试</p>
</li>
<li>
<p>Coco，代码覆盖率分析</p>
</li>
<li>
<p>Test Center，测试结果管理和分析</p>
</li>
<li>
<p>Axivion，静态代码分析与架构验证</p>
</li>
<li>
<p>Qt Insight，https://www.qt.io/product/insight。</p>
</li>
</ul>
<h2 id="qt-qml-常用控件总结备查--俯瞰">Qt QML 常用控件总结备查 / 俯瞰</h2>
<h3 id="qtquick">QtQuick</h3>
<ul>
<li>
<p>Item（x、y、z、width、height、visible、enabled、foucus、anchors、status、clip、opacity、forceActiveFocus() 等等）</p>
<p>The Item type is the base type for all visual items in Qt Quick.</p>
</li>
<li>
<p>Rectangle</p>
</li>
<li>
<p>Text</p>
</li>
<li>
<p>Column、Row、Grid、Flow；GridView</p>
</li>
<li>
<p>MouseArea（MouseEvent，WheelEvent）</p>
</li>
<li>
<p>Keys（KeyEvent），Drag（DragEvent）</p>
</li>
<li>
<p>Image</p>
</li>
<li>
<p>Loader</p>
</li>
<li>
<p>TextInput；TextEdit</p>
</li>
</ul>
<h3 id="qtquickwindow">QtQuick.Window</h3>
<ul>
<li>Window（CloseEvent）</li>
</ul>
<h3 id="qtqml">QtQml</h3>
<p>（QtQuick.Controls 包含 QtQml）</p>
<ul>
<li>Component</li>
<li>Binding、Connections</li>
<li>Timer</li>
</ul>
<h3 id="qtquicklayouts">QtQuick.Layouts</h3>
<ul>
<li>GridLayout</li>
<li>ColumnLayout、RowLayout</li>
<li>StackLayout</li>
</ul>
<h3 id="qtquickcontrols">QtQuick.Controls</h3>
<p>（包含 QtQml）（有 1系列版本 和 2系列版本，其内的控件有差别）：</p>
<ul>
<li>ApplicationWindow</li>
<li>Label</li>
<li>Button、RadioButton、RoundButton、Switch</li>
<li>CheckBox、GroupBox、SpinBox</li>
<li>TextField；TextArea</li>
<li>BusyIndicator、Dial、ProgressBar</li>
<li>Slider、RangeSlider</li>
<li>ScrollBar、ScrollView</li>
<li>ListView</li>
<li>Menu、MenuBar</li>
<li>ComboBox</li>
<li>TabView（QtQuick.Controls 1.4）、TableView</li>
<li>Calendar、Tumbler</li>
<li>StackView、Page、Dialog、Popup</li>
</ul>
<h3 id="qtquickdialogs">QtQuick.Dialogs</h3>
<ul>
<li>ColorDialog	Dialog component for choosing a color</li>
<li>Dialog		A generic QtQuick dialog wrapper with standard buttons</li>
<li>FileDialog		Dialog component for choosing files from a local filesystem</li>
<li>FontDialog	Dialog component for choosing a font</li>
<li>MessageDialog	Dialog component for displaying popup messages</li>
</ul>
<h3 id="other">Other</h3>
<ul>
<li>QtCharts</li>
<li>QtQuick.VirtualKeyboard（QtQuick.VirtualKeyboard.Settings）</li>
<li>QtTest		This module provides QML types to unit test your QML application</li>
<li>QtAudioEngine	音频相关</li>
<li>QtMultimedia	视频播放、摄像头等支持</li>
<li>QtSensors	读传感器相关</li>
<li>QtWayland.Compositor	Provides QML types for writing custom Wayland display servers</li>
<li>QtWebEngine	Provides QML types for rendering web content within a QML application</li>
<li>QtWebView	显示本地网页</li>
<li>QtWebSockets	Provides QML types for WebSocket-based communication</li>
<li>QtWinExtras	Enables the use of Windows features with QML</li>
</ul>
<h2 id="实用三方组件收集">实用三方组件收集</h2>
<p><a href="https://blog.csdn.net/m0_60259116/article/details/134247505">https://blog.csdn.net/m0_60259116/article/details/134247505</a>。</p>
<blockquote>
<ul>
<li>一、自定义控件</li>
<li>二、图表控件</li>
<li>三、网络</li>
<li>四、 音视频</li>
<li>五、多线程</li>
<li>六、数据库</li>
</ul>
</blockquote>
<p>这些已经加到我的 github star 里面了 <a href="https://github.com/stars/Staok/lists/qt" target="_blank" rel="noopener noreffer">Your list / QT</a>。</p>
<h2 id="常用基础--经验">常用基础 &amp; 经验</h2>
<ul>
<li>控件的 属性 properties 和 方法 methods 使用。</li>
<li>调用组件、设置属性，自定义组件、页面，属性暴露，属性参数传递。信号和槽。</li>
<li>会看和会使用 Qt 自带帮助。</li>
</ul>
<h3 id="c-端-显示-qml-文件">C++ 端 显示 Qml 文件</h3>
<ul>
<li>
<p>QQmlApplicationEngine 搭配 qml 文档 根控件 Window 或 ApplicationWindow（看手册有哪些属性，前面 相比于 后面 那种，对于窗口的控制权更多）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;QGuiApplication&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QQmlApplicationEngine&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">QGuiApplication</span> <span class="err">或</span> <span class="n">QApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">QQmlApplicationEngine</span> <span class="n">engine</span><span class="p">;</span>
    <span class="n">engine</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">QUrl</span><span class="p">(</span><span class="n">QLatin1String</span><span class="p">(</span><span class="s">&#34;qrc:/main.qml&#34;</span><span class="p">)));</span>
    <span class="k">return</span> <span class="n">app</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">//main.qml
</span><span class="c1"></span><span class="n">Window</span> <span class="err">或</span> <span class="n">ApplicationWindow</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="n">main_window</span>
    <span class="nl">objectName</span><span class="p">:</span> <span class="s">&#34;main_window_objName&#34;</span>
    <span class="nl">visible</span><span class="p">:</span> <span class="nb">true</span>
    <span class="nl">width</span><span class="p">:</span> <span class="mi">480</span>
    <span class="nl">height</span><span class="p">:</span> <span class="mi">320</span>
    <span class="nl">minimumWidth</span><span class="p">:</span> <span class="mi">480</span>
    <span class="nl">minimumHeight</span><span class="p">:</span> <span class="mi">320</span>
    <span class="nl">title</span><span class="p">:</span> <span class="n">qsTr</span><span class="p">(</span><span class="s">&#34;Ts File Translation Tool&#34;</span><span class="p">)</span>
        <span class="p">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>QQuickView 搭配 qml 文档 根控件 Item（适合嵌入式）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;QGuiApplication&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QQuickView&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">QGuiApplication</span> <span class="err">或</span> <span class="n">QApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">QQuickView</span> <span class="n">viewe</span><span class="p">;</span>
    <span class="n">viewe</span><span class="p">.</span><span class="n">setSource</span> <span class="p">(</span><span class="n">QUrl</span><span class="p">(</span><span class="s">&#34;qrc:/main.gml&#34;</span><span class="p">));</span>
    <span class="n">viewe</span><span class="p">.</span><span class="n">show</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">app</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="qml-基础语法">QML 基础语法</h3>
<ul>
<li>
<p><a href="https://www.cnblogs.com/linuxandmcu/p/11594541.html">https://www.cnblogs.com/linuxandmcu/p/11594541.html</a>            语法，变量，原始类型，类型转换（内置函数），函数</p>
</li>
<li>
<p><a href="https://www.ngui.cc/el/2490436.html?action=onClick">https://www.ngui.cc/el/2490436.html?action=onClick</a>                     QML 中常用的 JS 函数整理</p>
</li>
<li>
<p><a href="https://blog.51cto.com/u_15333750/5867537">https://blog.51cto.com/u_15333750/5867537</a>                                  基本组件调用，自定义信号、发射信号和槽函数，事件</p>
</li>
<li>
<p><a href="https://blog.csdn.net/wenxingchen/article/details/128515623">https://blog.csdn.net/wenxingchen/article/details/128515623</a>     自定义信号、发射信号和槽函数</p>
</li>
<li>
<p><a href="https://blog.csdn.net/gmcnoah/article/details/129816489">https://blog.csdn.net/gmcnoah/article/details/129816489</a>            QML中的函数和方法</p>
</li>
<li>
<p><a href="https://blog.csdn.net/douzhq/article/details/80959516">https://blog.csdn.net/douzhq/article/details/80959516</a>                 QML JS 循环语句。其它判断语句等同理</p>
</li>
<li>
<p>Qt中connect中<code>[]() and [&amp;]()</code>有什么区别？</p>
<p><a href="https://blog.csdn.net/caridle/article/details/129767443">https://blog.csdn.net/caridle/article/details/129767443</a></p>
<p><a href="https://blog.csdn.net/qq_45675910/article/details/107183512">https://blog.csdn.net/qq_45675910/article/details/107183512</a></p>
</li>
</ul>
<h3 id="qml-较全面的基础-api-介绍">QML 较全面的基础 API 介绍</h3>
<p><a href="https://blog.csdn.net/m0_60259116/article/details/129249920">https://blog.csdn.net/m0_60259116/article/details/129249920</a></p>
<blockquote>
<ul>
<li>ECMAScript</li>
<li>Qt 对象系统</li>
<li>Qt Quick 标准库</li>
</ul>
</blockquote>
<p>QML 字符串、数组、MATH</p>
<p><a href="https://blog.csdn.net/m0_60259116/article/details/129250132">https://blog.csdn.net/m0_60259116/article/details/129250132</a></p>
<p>indexOf、search、match、length、concat、slice、substring、replace、arg()、RegExp</p>
<p><a href="https://blog.csdn.net/m0_60259116/article/details/129250261">https://blog.csdn.net/m0_60259116/article/details/129250261</a></p>
<p>Date、Objec、其它更多实用方法</p>
<h3 id="qml-中几种信号和槽">QML 中几种信号和槽</h3>
<ul>
<li>
<p>控件的属性 或 自定的属性 的值 发送变化： <code>on&lt;Property&gt;Changed : { ... }</code>。</p>
</li>
<li>
<p>qml 控件提供的信号：<code>on&lt;Signal&gt;: { ... }</code>，qml 控件提供了哪些 信号 可以看其手册。</p>
</li>
<li>
<p>附加属性的信号，需要写全 <code>&lt;控件&gt;.on&lt;Signal&gt;</code>：<code>Component.onCompleted: { ... }</code>，<code>Keys.onReturnPressed: { ... }</code>，更多：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">Keys</span><span class="p">.</span><span class="nx">enabled</span><span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">Keys</span><span class="p">.</span><span class="nx">onPressed</span><span class="o">:</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">key</span><span class="p">){</span>
        <span class="k">case</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">Key_Left</span><span class="o">:</span>
          <span class="nx">x</span> <span class="o">==</span> <span class="mi">10</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">Key_Right</span><span class="o">:</span>
          <span class="nx">x</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">Key_Down</span><span class="o">:</span>
          <span class="nx">y</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">Key_Up</span><span class="o">:</span>
          <span class="nx">y</span> <span class="o">-=</span> <span class="mi">10</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">accepted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>官方信号与槽介绍，与三方库交互</p>
<p><a href="https://doc.qt.io/qt-5/signalsandslots.html#using-qt-with-3rd-party-signals-and-slots">https://doc.qt.io/qt-5/signalsandslots.html#using-qt-with-3rd-party-signals-and-slots</a></p>
<p>多个槽函数连接一个信号，信号发出后，槽函数按照连接的顺序执行。</p>
<p>槽函数里面也可以得到信号发送者。</p>
<p><a href="https://blog.csdn.net/m0_73443478/article/details/128332487">https://blog.csdn.net/m0_73443478/article/details/128332487</a></p>
<h3 id="c-实现-qt-的信号槽机制">C++ 实现 Qt 的信号槽机制</h3>
<p><a href="https://blog.csdn.net/weixin_41098116/article/details/130281834">https://blog.csdn.net/weixin_41098116/article/details/130281834</a></p>
<p><a href="https://blog.csdn.net/canon20070904/article/details/122728859">https://blog.csdn.net/canon20070904/article/details/122728859</a></p>
<p>另外有 C++ 的 信号槽库如 libsigc++、KDBindings 等 可以直接用~</p>
<p>参考 <a href="https://github.com/Staok/Cpp-Learning/blob/main/C-C%2B%2B%e5%ae%9e%e7%94%a8%e5%ba%93%e5%a4%87%e6%9f%a5.md#sig-slot" target="_blank" rel="noopener noreffer">Cpp-Learning/C-C++实用库备查.md at main · Staok/Cpp-Learning</a>。</p>
<h3 id="qml-控件-id-作用域">QML 控件 ID 作用域</h3>
<p><a href="https://blog.csdn.net/ykun089/article/details/120745716">https://blog.csdn.net/ykun089/article/details/120745716</a></p>
<p><a href="https://blog.csdn.net/qq_31375721/article/details/125173953">https://blog.csdn.net/qq_31375721/article/details/125173953</a></p>
<ul>
<li>子控件内部 可以访问到 自己的 ID，子控件也可以访问 同级别 其它控件的 ID。</li>
<li>子控件可以访问到 上级们的控件的 ID，子控件也可以访问到 上级们的 同级别的 控件的 ID。</li>
<li>但是 子控件 存在无法访问到 同级别控件的 子控件的 ID 的问题，这时应该将 后者 ID 通过 property alias 放到 本 qml 文件的 最前面的 根控件 下，作为本 qml 文件的全局变量，就可以访问到。其它情况同理。</li>
</ul>
<h3 id="qml-属性绑定和解绑">QML 属性绑定和解绑</h3>
<p><a href="https://cloud.tencent.com/developer/article/1463416">https://cloud.tencent.com/developer/article/1463416</a></p>
<p><a href="https://blog.csdn.net/CLinuxF/article/details/90713508">https://blog.csdn.net/CLinuxF/article/details/90713508</a></p>
<p>函数绑定 <a href="https://cloud.tencent.com/developer/article/1625079">https://cloud.tencent.com/developer/article/1625079</a></p>
<p>总结：</p>
<ul>
<li>
<p>property : xxx，后面再使用 <code>=</code> 赋值 则解除旧绑定而使用新绑定。</p>
</li>
<li>
<p>使用 <code>Binding</code>控件对已经解除绑定的属性重新绑定。</p>
</li>
<li>
<p>在 js 函数内绑定 <code>rect.height = Qt.binding(function() { return this.width * 2 })</code>。</p>
</li>
<li>
<p>Connections。可以在 Item 里面用（其它的像 <code>on&lt;Singal&gt;</code>不能写在 Item 里），用于连接信号和槽，比较好用。</p>
<p><a href="https://blog.csdn.net/douzhq/article/details/81007504">https://blog.csdn.net/douzhq/article/details/81007504</a></p>
</li>
</ul>
<h3 id="qml-与-c-相互调用">QML 与 C++ 相互调用</h3>
<h4 id="qml-调用-c-类">QML 调用 C++ 类</h4>
<p>​	https://blog.csdn.net/byxdaz/article/details/89304074</p>
<p>​	https://blog.csdn.net/Y03977211367Y/article/details/111434962</p>
<p>​    自己定义类，公共继承自 <code>QObject</code>，且添加 <code>Q_OBJECT</code> 宏（则 Qml 里面 可 使用该类里面的 属性、方法（函数），以及信号和槽），若不使用 信号和槽，可用更轻量的宏 <code>Q_GADGET</code>。</p>
<p>​    坑！若这个类要给另一个工程（.pro）用 要在 class 右边添加 <code>Q_DECL_EXPORT</code> 修饰符，并且引用头文件 <code>#include &lt;QtCore/qglobal.h&gt;</code>。</p>
<p>​    类里面 使用 <code>Q_PROPERTY</code> 修饰 要给 qml 访问的各个属性 / 变量，使用 <code>Q_INVOKABLE</code> 修饰 要给 qml 访问的各个函数 / 方法。典型实现看 <code>tsFile_translation_tool</code>。</p>
<p>​    写函数时，尤其是定义 属性 property 的读写 函数，形参可以写成引用，返回值不能写成引用（除非返回的是静态变量）而是拷贝，要形成这个习惯，因为如果函数里面有申请堆内存，比如 c++ stl 容器 等，返回引用的话那么这块内存就不会释放了，如果频繁调用该函数，很容易内存泄漏。</p>
<p>1 用 <code>setContextProperty()</code>（要在 load qml 之前），即在 c++ 里面先例化类，再注册，qml 里面就可以直接用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">QDataMgr</span> <span class="n">data_mgr</span><span class="p">;</span> <span class="c1">// 先例化类
</span><span class="c1"></span><span class="n">engine</span><span class="p">.</span><span class="n">rootContext</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">setContextProperty</span><span class="p">(</span><span class="s">&#34;DATAMGR&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data_mgr</span><span class="p">);</span> 
<span class="c1">// 注册后则可以在 qml 里面 通过 DATAMGR 使用该类里面的 属性、方法（函数），以及信号和槽
</span></code></pre></td></tr></table>
</div>
</div><p>2 用 <code>qmlRegisterSingletonType()</code>，注册单例控件（要在 load qml 之前），这是 带回调的注册函数 <a href="https://blog.csdn.net/weixin_42208702/article/details/132001997">https://blog.csdn.net/weixin_42208702/article/details/132001997</a></p>
<p>好的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">qmlRegisterSingletonType</span><span class="o">&lt;</span><span class="n">FileManagerQt</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;FileManagerQt&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#34;FileManager&#34;</span><span class="p">,</span>
										<span class="p">[](</span><span class="n">QQmlEngine</span><span class="o">*</span><span class="p">,</span> <span class="n">QJSEngine</span><span class="o">*</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QObject</span><span class="o">*</span> <span class="p">{</span>
	<span class="n">QQmlEngine</span><span class="o">::</span><span class="n">setObjectOwnership</span><span class="p">(</span><span class="o">&amp;</span><span class="n">FileManagerQt</span><span class="o">::</span><span class="n">inst</span><span class="p">(),</span> <span class="n">QQmlEngine</span><span class="o">::</span><span class="n">CppOwnership</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">FileManagerQt</span><span class="o">::</span><span class="n">inst</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// 类的 ::inst() 定义，例子：
</span><span class="c1"></span><span class="k">class</span> <span class="nc">FileManagerQt</span>
    <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span><span class="p">,</span> <span class="k">public</span> <span class="n">FileManager</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>
	<span class="p">...</span>
<span class="k">public</span><span class="o">:</span>
	<span class="k">static</span> <span class="n">FileManagerQt</span> <span class="o">&amp;</span> <span class="n">inst</span><span class="p">();</span>
	<span class="p">...</span>
<span class="nl">signals</span><span class="p">:</span>
    <span class="p">...</span>
<span class="k">public</span> <span class="nl">slots</span><span class="p">:</span>
    <span class="p">...</span>
<span class="k">private</span><span class="o">:</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="n">FileManagerQt</span> <span class="o">&amp;</span> <span class="n">FileManagerQt</span><span class="o">::</span><span class="n">inst</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">FileManagerQt</span> <span class="n">FileManagerQt_</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">FileManagerQt_</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>3 qmlRegisterType()，常规注册方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">qmlRegisterType</span><span class="o">&lt;</span><span class="n">FileSimple</span><span class="err">（类名）</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;FileSimple（库名，一般与类名一致）&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#34;FileSimpleItem（控件名）&#34;</span><span class="p">);</span>
                                                                          <span class="c1">// 注意 控件名 首字母要大写
</span><span class="c1"></span>
<span class="c1">// qml 里面：
</span><span class="c1"></span><span class="n">import</span> <span class="n">FileSimple</span> <span class="mf">1.0</span>
    <span class="p">...</span>
    <span class="n">FileSimpleItem</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="n">fileSimpleItem</span>
        <span class="nl">objectName</span><span class="p">:</span> <span class="s">&#34;fileSimpleItem_objName&#34;</span>
        <span class="n">Component</span><span class="p">.</span><span class="nl">onCompleted</span><span class="p">:</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="c1">// 便可以用 fileSimpleItem 来使用 FileSimple 类 里面的东西
</span></code></pre></td></tr></table>
</div>
</div><p>​</p>
<p>4 qmlRegisterUncreatableType() <a href="https://blog.csdn.net/cleverhorse/article/details/86494983">https://blog.csdn.net/cleverhorse/article/details/86494983</a></p>
<p>​	即 qml 里面不可创建（类的）对象 的控件，只用其对应的 类 里面的东西，对于类里面提供很多 枚举值 很适用这种注册方法。</p>
<p>​	使用 <code>Q_ENUM</code> 修饰 类里面的 枚举类型。</p>
<h4 id="c-调用-qml">C++ 调用 QML</h4>
<p>​	https://blog.csdn.net/m0_73443478/article/details/129844458</p>
<p>​	https://blog.csdn.net/baidu_33850454/article/details/81941675</p>
<p>​	读 qml 内属性，典型程序见 <code>加埋点</code> 和 <code>具体控件</code> 一节的 <code>EventFilter</code>，就是从 rootObject 通过 objectName 或者 id 寻找 子 obj，再可以读写 qml 里面 控件 的 属性等等。</p>
<p>​	调用 qml 里的 js 函数不常用，也不推荐，因为前端尽量只做展示，业务放在 c++ 后端。</p>
<h3 id="多语言--字体">多语言 &amp; 字体</h3>
<p>​	https://blog.csdn.net/zhengtianzuo06/article/details/78550695</p>
<p>​	https://blog.csdn.net/qq_45477402/article/details/124443527</p>
<ol>
<li>
<p>qml 和 c++ 中要多语言支持的文案分别使用 <code>qsTr(&quot;&lt;str&gt;&quot;) 或 qsTrId</code> 和 <code>QObject::tr(&quot;&lt;str&gt;&quot;) 或 </code> 或 <code>QT_TR_NOOP</code>。</p>
</li>
<li>
<p>在工程文件 .pro 中加入<code>TRANSLATIONS = zh_CN.ts en_US.ts ...</code>。</p>
</li>
<li>
<p>用 Qt 自带的 lupdate 生成 .ts 文件：<code>工具 -&gt; 外部 -&gt;  Qt预言家 -&gt; 更新翻译(lupdate)</code>。</p>
</li>
<li>
<p>然后ts文件可以通过各种软件翻译，QT官方使用的是 Qt Linguist，也可以使用 localazy 或者其他工具。</p>
<p>用 linguist Qt 语言家工具翻译：用该软件打开 .ts 文件 并逐条翻译 后保存，在 Qt 里面：<code>工具 -&gt; 外部 -&gt;  Qt预言家 -&gt; 发布翻译(lrelease)</code>，则生成 .qm 文件，不行的话就 用 linguist 工具翻译并发布为 .qm 文件。</p>
</li>
<li>
<p>C++ 里面使用 QTranslator 相关函数 加载 .qm 文件并执行，界面即切换成对应语言。</p>
</li>
</ol>
<p>全局字体设置：</p>
<p>​	https://blog.csdn.net/qq_24890953/article/details/107557023</p>
<h3 id="控件位置和排列设置">控件位置和排列设置</h3>
<p>常用的方式是：</p>
<p>界面左上角第一个组件用x、y 定好位置（或其它方式，或设置可随窗口变化），然后其它组件用 anchors 定与之的相对位置（或随窗口变化），长宽可固定设置或随窗口变化。</p>
<p>如果是有规律的列表显示，多个组件的重复排列，可用 ListView 或 Repeater，推荐前者。</p>
<p>Qml 里面不用 Row/Column 相对位置组件（实测用了之后很多 UIBase 库中的组件容易出问题，估计实现上有冲突）。
多用 Item / Rectangle 和 anchors 来 框住同框的组件 和 组件内的相对位置设置。</p>
<p>使用了 定位器 或 布局管理器 的控件，其 x、y、anchor 等定位属性就无效了，不要再用了。</p>
<blockquote>
<p>定位器包括Row(行定位器)、Column(列定位器)、Grid(表格定位器)、Flow(流式定位器)。
布局管理器包括行布局(RowLayout)、列布局(ColumnLayout)、表格布局(GridLayout)。</p>
<p>QtQuick中的布局管理器与QtWidgets中的相似，它与定位器的不同之处在于：布局管理器会自动调整子Item的尺寸来适应界面大小的变化。</p>
<p>GridLayout所管理的Item，可以使用下列附加属性(这正是布局管理理器和定位器之关键不同点)：</p>
<ul>
<li>Layout.row</li>
<li>Layout.column</li>
<li>Layout.rowSpan</li>
<li>Layout.columnSpan</li>
<li>Layout.fill Width</li>
<li>Layout.fill Height</li>
<li>Layout.alignment</li>
</ul>
</blockquote>
<p>横竖排列，网格排列：</p>
<p>QML GridLayout 和 Grid</p>
<p><a href="https://blog.csdn.net/mengfz_cn/article/details/120094644">https://blog.csdn.net/mengfz_cn/article/details/120094644</a></p>
<p>Column 里面的 Item 不要再用 anchor，因为column已经在帮你管理item的位置了。你设置了anchor如果和column冲突，是无效的。</p>
<p><a href="https://ask.csdn.net/questions/10917">https://ask.csdn.net/questions/10917</a></p>
<h2 id="问题解决">问题解决</h2>
<h4 id="工程文件-pro-解析">工程文件 .pro 解析</h4>
<p><a href="https://zhuanlan.zhihu.com/p/616842442">https://zhuanlan.zhihu.com/p/616842442</a>。</p>
<h4 id="更新-qml-再运行">更新 qml 再运行</h4>
<p>qml 文件代码更改后直接构建运行还是上次的结果解决：https://tieba.baidu.com/p/4206771409。</p>
<p>或者，在 Qt 工程里项目文件夹上面右击选择 “执行qmake” 一下再 Run。</p>
<h4 id="qt-非阻塞处理机制qt-的-单线程循环-qeventloop-和-多线程-qthread-编程">Qt 非阻塞处理机制（Qt 的 单线程循环 QEventLoop 和 多线程 QThread 编程）</h4>
<p>看这篇 <a href="https://zhuanlan.zhihu.com/p/614426792">https://zhuanlan.zhihu.com/p/614426792</a>，分为</p>
<ul>
<li>非阻塞（主线程）同步。即 QEventLoop，同步等待，但是不阻塞 GUI 主线程。</li>
<li>非阻塞（主线程）异步，即 多线程，线程内处理后用 回调函数 或者 信号槽机制 异步的返回结果再处理。</li>
</ul>
<p>非阻塞同步：</p>
<ul>
<li>
<p>QEventLoop。https://blog.csdn.net/QtCompany/article/details/129282296，用事件循环方式 QEventLoop 同步等待。</p>
<p>在本文里面直接搜 QEventLoop，有一些例子。</p>
</li>
</ul>
<p>非阻塞异步：</p>
<ul>
<li>
<p>线程法。QThread，写个类继承 QThread，写个设置运行函数的 方法成员，用 std::function 接，填入函数可以用 lambda 并捕获必要的上下文数据。</p>
<p><a href="https://blog.csdn.net/qq_37529913/article/details/110521759">https://blog.csdn.net/qq_37529913/article/details/110521759</a></p>
<p>或者 std::thread 如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// add format_sdcard_exec() to a thread to exec
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="n">t</span><span class="p">(</span><span class="n">format_sdcard_exec</span><span class="p">);</span> <span class="n">t</span><span class="p">.</span><span class="n">detach</span><span class="p">();</span>

<span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="n">t</span><span class="p">(</span> <span class="p">[]</span> <span class="p">(...)</span> <span class="p">{...});</span> <span class="n">t</span><span class="p">.</span><span class="n">detach</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><p>这种临时任务另启一个线程可以，但是遇事不决就随意新开线程不推荐，增加线程切换负担。</p>
</li>
<li>
<p>QtConcurrent。本质是使用线程池</p>
<p><a href="https://blog.csdn.net/danxibaoxxx/article/details/121381000">https://blog.csdn.net/danxibaoxxx/article/details/121381000</a></p>
<p><a href="https://blog.csdn.net/HighproX/article/details/127074258">https://blog.csdn.net/HighproX/article/details/127074258</a></p>
</li>
</ul>
<h4 id="子页面向父页面传参">子页面向父页面传参</h4>
<p>StackView 子页面向父页面传参</p>
<p><a href="https://blog.csdn.net/weixin_44820280/article/details/123253576">https://blog.csdn.net/weixin_44820280/article/details/123253576</a></p>
<p>即 子页面添加一个绑定 父页面 obj 的属性，只能用 obj 去绑定本属性！因为绑定具体属性的话，子页面里面修改属性就解除绑定了，而绑定 obj，这个不改变因此不会解绑。</p>
<p>如果是使用 loader 等切页，那么 还是将所用到的数据均在 c++ 后端写数据结构进行抽象和存储吧，这是规范的。</p>
<h4 id="qml-圆角矩形-radius-clip-对子组件无效">QML 圆角矩形 radius clip 对子组件无效</h4>
<p><a href="https://blog.csdn.net/likianta/article/details/110703819">https://blog.csdn.net/likianta/article/details/110703819</a></p>
<p><a href="https://blog.csdn.net/gongjianbo1992/article/details/114465501">https://blog.csdn.net/gongjianbo1992/article/details/114465501</a></p>
<p><a href="https://stackoverflow.com/questions/6090740/image-rounded-corners-in-qml">https://stackoverflow.com/questions/6090740/image-rounded-corners-in-qml</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">Image</span> <span class="p">{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">img</span>
        <span class="nx">property</span> <span class="nx">bool</span> <span class="nx">rounded</span><span class="o">:</span> <span class="kc">true</span>
        <span class="nx">property</span> <span class="nx">bool</span> <span class="nx">adapt</span><span class="o">:</span> <span class="kc">true</span>

        <span class="nx">width</span><span class="o">:</span> <span class="mi">200</span>
        <span class="nx">height</span><span class="o">:</span> <span class="mi">200</span>

        <span class="nx">anchors</span><span class="p">.</span><span class="nx">centerIn</span><span class="o">:</span> <span class="nx">parent</span>
        <span class="nx">source</span><span class="o">:</span> <span class="s2">&#34;file:///xxx/images/bug.png&#34;</span>

        <span class="nx">layer</span><span class="p">.</span><span class="nx">enabled</span><span class="o">:</span> <span class="nx">rounded</span>
        <span class="nx">layer</span><span class="p">.</span><span class="nx">effect</span><span class="o">:</span> <span class="nx">OpacityMask</span> <span class="p">{</span>
            <span class="nx">maskSource</span><span class="o">:</span> <span class="nx">Item</span> <span class="p">{</span>
                <span class="nx">width</span><span class="o">:</span> <span class="nx">img</span><span class="p">.</span><span class="nx">width</span>
                <span class="nx">height</span><span class="o">:</span> <span class="nx">img</span><span class="p">.</span><span class="nx">height</span>
                <span class="nx">Rectangle</span> <span class="p">{</span>
                    <span class="nx">anchors</span><span class="p">.</span><span class="nx">centerIn</span><span class="o">:</span> <span class="nx">parent</span>
                    <span class="nx">width</span><span class="o">:</span> <span class="nx">img</span><span class="p">.</span><span class="nx">adapt</span> <span class="o">?</span> <span class="nx">img</span><span class="p">.</span><span class="nx">width</span> <span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
                    <span class="nx">height</span><span class="o">:</span> <span class="nx">img</span><span class="p">.</span><span class="nx">adapt</span> <span class="o">?</span> <span class="nx">img</span><span class="p">.</span><span class="nx">height</span> <span class="o">:</span> <span class="nx">width</span>
                    <span class="nx">radius</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="显示图片">显示图片</h4>
<p>Qt Image 控件 显示图片，根据图片文件后缀名加载，若图片本身编码和后缀名不一致会导致显示失败，解决办法</p>
<p><a href="https://blog.csdn.net/qiangzi4646/article/details/80764262">https://blog.csdn.net/qiangzi4646/article/details/80764262</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cm">/*  if img file(imgFilePathIn) suffix is not match the img file encode, then correct the suffix(named imgFilePathOut)
</span><span class="cm">    then rename the &#34;imgFilePathIn&#34; file to right one &#34;imgFilePathOut&#34;
</span><span class="cm">    please write some COMMENTs, for the others
</span><span class="cm">*/</span>
<span class="n">QString</span> <span class="nf">correctImgFileSuffix</span><span class="p">(</span><span class="n">QString</span><span class="o">&amp;</span> <span class="n">imgFilePathIn</span><span class="p">,</span> <span class="n">QString</span><span class="o">&amp;</span> <span class="n">imgFilePathOut</span><span class="p">,</span> \
        <span class="kt">bool</span> <span class="n">isOnlyReturnSuffix</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&amp;</span> <span class="n">isCorrectSuffix</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">imgFilePathOut</span> <span class="o">=</span> <span class="n">imgFilePathIn</span><span class="p">;</span>

    <span class="n">QFileInfo</span> <span class="n">_fileInInfo</span><span class="p">(</span><span class="n">imgFilePathIn</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">_suffix</span> <span class="o">=</span> <span class="n">_fileInInfo</span><span class="p">.</span><span class="n">suffix</span><span class="p">();</span>

    <span class="n">QFile</span> <span class="n">_filein</span><span class="p">(</span><span class="n">imgFilePathIn</span><span class="p">);</span>
    <span class="n">_filein</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">QIODevice</span><span class="o">::</span><span class="n">ReadOnly</span><span class="p">);</span>
    <span class="n">QDataStream</span> <span class="n">file_in</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_filein</span><span class="p">);</span>
    <span class="n">quint32</span> <span class="n">magic</span><span class="p">;</span>
    <span class="n">file_in</span> <span class="o">&gt;&gt;</span> <span class="n">magic</span><span class="p">;</span>

    <span class="cm">/* refer https://blog.csdn.net/qiangzi4646/article/details/80764262
</span><span class="cm">        img file head info
</span><span class="cm">        .jpg    ffd8ff      JPEG (jpg)
</span><span class="cm">        .jpeg   ffd8ff      JPEG (jpg)
</span><span class="cm">        .jpe    ffd8ff      JPEG (jpg)
</span><span class="cm">        .png    89504e47     PNG (png)
</span><span class="cm">        .gif    47494638    GIF (gif)
</span><span class="cm">        .tif    49492a00    TIFF (tif)
</span><span class="cm">        .bmp    424d        16bit(bmp)
</span><span class="cm">    */</span>
    <span class="n">QString</span> <span class="n">correctSuffix</span> <span class="o">=</span> <span class="s">&#34;png&#34;</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">magic</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mh">0x89504e47</span> <span class="o">:</span> <span class="n">correctSuffix</span> <span class="o">=</span> <span class="s">&#34;png&#34;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mh">0xffd8ff</span> <span class="o">:</span>   <span class="n">correctSuffix</span> <span class="o">=</span> <span class="s">&#34;jpg&#34;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mh">0xffd8ffe0</span> <span class="o">:</span> <span class="n">correctSuffix</span> <span class="o">=</span> <span class="s">&#34;jpg&#34;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span> <span class="c1">// jfif
</span><span class="c1"></span>        <span class="k">case</span> <span class="mh">0x424d</span> <span class="o">:</span>     <span class="n">correctSuffix</span> <span class="o">=</span> <span class="s">&#34;bmp&#34;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mh">0x47494638</span> <span class="o">:</span> <span class="n">correctSuffix</span> <span class="o">=</span> <span class="s">&#34;gif&#34;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
            <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;correctImgFileName(): Unsupported image format&#34;</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">_suffix</span><span class="p">;</span> <span class="c1">// return origin file name : imgFilePathOut = imgFilePathIn;
</span><span class="c1"></span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">_suffix</span> <span class="o">==</span> <span class="n">correctSuffix</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">isCorrectSuffix</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">_suffix</span><span class="p">;</span> <span class="c1">// the correct img file suffix, do not need to change
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="n">isCorrectSuffix</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">isOnlyReturnSuffix</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_suffix</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// replace suffix to the right
</span><span class="c1"></span>    <span class="n">imgFilePathOut</span> <span class="o">=</span> <span class="n">imgFilePathIn</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#34;.&#34;</span> <span class="o">+</span> <span class="n">_suffix</span><span class="p">,</span> <span class="s">&#34;.&#34;</span> <span class="o">+</span> <span class="n">correctSuffix</span><span class="p">);</span>

    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;correctImgFileName(): imgFilePathOut&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">imgFilePathOut</span><span class="p">;</span>

    <span class="n">_filein</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">imgFilePathOut</span><span class="p">);</span>
    <span class="n">_filein</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">correctSuffix</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 用例：
</span><span class="c1"></span>        <span class="n">QString</span> <span class="n">file2</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">isCorrectSuffix</span><span class="p">;</span>
        <span class="n">QString</span> <span class="n">suffix_temp</span> <span class="o">=</span> <span class="n">correctImgFileSuffix</span><span class="p">(</span><span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">isCorrectSuffix</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">isCorrectSuffix</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;uncorrcet img suffix:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">file1</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>qml Image 控件显示图片的三种方式：https://blog.csdn.net/gongjianbo1992/article/details/128439262</p>
<blockquote>
<ol>
<li>从 Qt 资源系统加载：qrc://图片路径</li>
<li>文件加载：file://图片路径</li>
<li>由 ImageProvider 提供数据：image://provider路径</li>
</ol>
</blockquote>
<ol>
<li>
<p><code>qrc://</code> 方式 需要 图片添加到 qt 工程的 qrc 里面，如果是固定的素材则要这么做。</p>
</li>
<li>
<p><code>file://</code> 方式 是可以显示任意路径的图片（不必非要加在 qt 工程 的 qrc 文件里），但是是根据后缀名（suffix）来识别编码而不是识别文件内容，因此如果遇到 png 编码的图片 但 文件名后缀是 .jpg 就会不识别。写程序改后缀名的话不优雅。</p>
</li>
<li>
<p><strong>好用！</strong><code>image://&lt;provider&gt;/</code> 的方式 是 c++ 后端 写个 provider，内存方式 给 Image 控件 显示，这个不受 图片 后缀名 限制，可以正确显示图片。provider 很好用，可以写个通用的，供 qml 里面 Image 显示图片，QImageReader 提供了不少丰富功能，包括根据图片内容识别图片格式（这就可以直接解决上面说的 问题），还有 Scale 设置、裁剪 等等等。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">QFile</span><span class="o">::</span><span class="n">ReadOnly</span><span class="p">))</span> 
<span class="p">{</span>
    <span class="n">QImageReader</span> <span class="nf">reader</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
    <span class="n">reader</span><span class="p">.</span><span class="n">setDecideFormatFromContent</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span> <span class="c1">// add this to let QImageReader Decide Format From Content
</span><span class="c1"></span>    <span class="n">reader</span><span class="p">.</span><span class="n">setScaledSize</span><span class="p">(</span><span class="n">scaledSize</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
    <span class="k">auto</span> <span class="n">image</span> <span class="o">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">isNull</span><span class="p">())</span>
        <span class="n">errorString_</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="n">fileName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="n">reader</span><span class="p">.</span><span class="n">errorString</span><span class="p">();</span>
    <span class="k">else</span>
        <span class="n">image_</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
    <span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>然后很坑很重要：https://blog.csdn.net/weixin_39628268/article/details/111979647</p>
<ul>
<li>win 下，Image：<code>source: &quot;file:///&quot; + &quot;C:/Desert.jpg&quot;</code>，必须要三个斜杠后面加地址。</li>
<li>linux 和 安卓 下：这两个系统是一样的路径：<code>“file://&quot; + &lt;path&gt;</code>。</li>
<li>这些路径变换，用下面的 转换函数即可！</li>
</ul>
<p>函数做转换</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="c1">// remove &#34;file:///&#34; to let QFile handle
</span><span class="c1"></span><span class="n">QString</span> <span class="n">file1</span> <span class="o">=</span> <span class="n">QUrl</span><span class="p">(</span><span class="n">posterUrl_</span><span class="p">).</span><span class="n">toLocalFile</span><span class="p">();</span>

<span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;———————— 1 posterUrl_ &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">posterUrl_</span><span class="p">;</span>
<span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;———————— 2 file1 &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">file1</span><span class="p">;</span>

<span class="c1">// add &#34;file:///&#34; to the front to let Image show this pic
</span><span class="c1"></span><span class="n">posterUrl_</span> <span class="o">=</span> <span class="n">QUrl</span><span class="o">::</span><span class="n">fromLocalFile</span><span class="p">(</span><span class="n">file2</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>

<span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;———————— 3 posterUrl_ &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">posterUrl_</span><span class="p">;</span>

<span class="cm">/* 打印结果：
</span><span class="cm">———————— 1 posterUrl_  &#34;file:///data/Auxiliaries/Model...Panda_01.jpg&#34;
</span><span class="cm">———————— 2 file1  &#34;/data/Auxiliaries/Model...Panda_01.jpg&#34;
</span><span class="cm">———————— 3 posterUrl_  &#34;file:///data/Auxiliaries/Model...Panda_01_1692158487.png&#34;
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="qt-事件传播链--加事件过滤">QT 事件传播链 / 加事件过滤</h4>
<p>参考 <a href="https://subingwen.cn/qt/event_handler/">https://subingwen.cn/qt/event_handler/</a></p>
<blockquote>
<ol>
<li>
<p>当事件产生之后，Qt使用用应用程序对象调用notify()函数将事件发送到指定的窗口</p>
<p>QApplication::notify</p>
</li>
<li>
<p>事件在发送过程中可以通过事件过滤器进行过滤，默认不对任何产生的事件进行过滤</p>
<p>QObject::eventFilter</p>
</li>
<li>
<p>当事件发送到指定窗口之后，窗口的事件分发器会对收到的事件进行分类</p>
<p>QWidget::event</p>
</li>
<li>
<p>事件分发器会将分类之后的事件（鼠标事件、键盘事件、绘图事件。。。）分发给对应的事件处理器函数进行处理，每个事件处理器函数都有默认的处理动作（我们也可以重写这些事件处理器函数），比如：鼠标事件</p>
<p>QWidget::mousePressEvent</p>
<p>QWidget::mouseReleaseEvent</p>
<p>QWidget::mouseMoveEvent</p>
</li>
</ol>
</blockquote>
<p>实现事件处理函数的几种方法，中间拦截事件，添加自己的处理逻辑</p>
<p><a href="https://www.51cto.com/article/272256.html">https://www.51cto.com/article/272256.html</a></p>
<p>以下，从下到上，也是 Qt 处理 事件的传播链顺序</p>
<blockquote>
<ol>
<li>重新实现事件函数。 比如： mousePressEvent(), keyPressEvent(),  paintEvent()</li>
<li>重新实现 QObject::event()</li>
<li>安装事件过滤器。即给 相应的 QObject 添加 EventFilter</li>
<li>在 QApplication 上安装事件过滤器</li>
<li>重新实现QApplication 的 notify()方法</li>
</ol>
</blockquote>
<p>qt 事件传播链大致为</p>
<ol>
<li>QApplication::notify()</li>
<li>QApplication::eventFilter()，虚函数，可重写，添加自己的处理逻辑</li>
<li>某个具体控件的 QObject::eventFilter()，虚函数，可重写，添加自己的处理逻辑</li>
<li>某个具体控件自己的 QObject::event()</li>
<li>某个具体控件的 某个事件相应函数，比如鼠标事件官方实现有细分  mousePressEvent()、mouseReleaseEvent() 等。</li>
</ol>
<p>添加 EventFilter</p>
<p>直接看 Qt 手册的 QObject 下的 eventFilter 函数的例子。</p>
<p>即给控件的事件添加回调函数 <code>eventFilter()</code>，事件发生（点击、快捷键、语言切换、调出虚拟键盘等等）先进入一个统一的回调函数。</p>
<p>具体方法：</p>
<ul>
<li>
<p>新版本的 qt 有 qml EventFilter 控件，可加到 qml 页面中。但是在 c++ 后端 写会更灵活。</p>
</li>
<li>
<p>后端 c++ 自写。具体原理就是，捕获具体某个控件的所有事件，就是这个控件发生了事件了，调用一个回调函数，里面 检查&amp;处理，返回 false 表示事件可以继续传播，返回 true 则 该 事件 不继续传播了。</p>
<ul>
<li>
<p>给 QApplication 或 QGuiApplication  添加 eventFilter()。拦截该 qt 界面中所有的事件。在 eventFilter() 给需要添加处理逻辑的控件加，或需要控件有全局唯一的 id 或 objectName。</p>
<p>参考 <a href="https://www.cnblogs.com/ourran/p/6816986.html">https://www.cnblogs.com/ourran/p/6816986.html</a> 在 QApplication 上安装事件过滤器，拦截所有 GUI 上发生的事件~</p>
</li>
<li>
<p>通过 qml 或者 页面的 根对象 rootObject，搜索其全部子对象，再逐一添加 eventFilter()。添加时就可以有选择性的。</p>
<p>参考 <a href="https://forum.qt.io/topic/110350/how-to-make-an-eventfilter">https://forum.qt.io/topic/110350/how-to-make-an-eventfilter</a></p>
<p>页面通过 loader 加载其它页面，可以用这个方法 也找到其它页面 的 根对象，首先找 loader 控件（通过 id 或者 objectName），然后找其 item 属性 得到 load 的 qml 对象的 rootObject。</p>
<p><a href="https://stackoverflow.com/questions/36418941/accessing-qml-objects-from-loaded-qml-using-cpp-code">https://stackoverflow.com/questions/36418941/accessing-qml-objects-from-loaded-qml-using-cpp-code</a></p>
<p>但是这个还有个问题，通过 stackView 加载的页面怎么获取。</p>
</li>
</ul>
</li>
</ul>
<p>存在问题 &amp; 问题解决：</p>
<ul>
<li>
<p>使用 QApplication::eventFilter()，那么全局的事件都会从这里过，会增加系统负担；另外，qml 或 widget 这种 UI 界面上 传播的是 信号 signal，不同于 后端的 event，event 是更原始的，signal 是处理后的 比如 单击 click 信号 是 按下 和 抬起 的 两个或多个事件的组合发生 的触发。</p>
<p>经过 嵌入式linux soc(A7) 上面测试，快速操作屏幕情况下，没有明显增加卡顿，cpu 占用也没有明显增加，最高均在 35% 左右。</p>
<p>所以要拦截事件（比如做埋点），更推荐使用下面的方法：</p>
<p>只使用某些具体控件自己的 QObject::event()，通过根对象寻找符合条件的（比如 id 或 objectName 属性（保持当前页面唯一） 包含 <code>track</code> 字符的则处理，否则直接返回）子对象 installEventFilter。对要埋点的控件必加 当前页面唯一的 id 或 objectName 属性。</p>
<p>对于在 listView 中的 按键，则要加 <code>listview</code> 标识符，程序中做特殊处理才能找打 ListView 中的具体哪一个按键被按下，比如 id 设置为 <code>&lt;widgetType&gt;_listviewBtn_&lt;page&gt;_&lt;name&gt;_track</code>。</p>
<p>加个 识别符 <code>track</code>，在 eventFilter() 里面可以 只识别带有该 标识符 的 控件的事件。</p>
</li>
<li>
<p>需要单独处理的。统一在 eventFilter() 添加逻辑，界面文件中控件要进行相应修改，而涉及功能逻辑部分不用动</p>
<ul>
<li>
<p>某些控件暂，还需要想办法优化代码实现。无法取到 ListView 的 delegate 的 Component 以及其下控件的 objectName。</p>
<p>对于 ListView 的 delegate 里的按键控件，要单独添加处理，处理方法：</p>
<p>delegate 中的 按键控件，id 中加一个特殊标识符 比如 <code>listviewBtn</code>，比如导航列表中的 ListView 下的 按键 的 id 合起来就是比如 <code>zbutton_listviewBtn_nav_track</code>，然后在 eventFilter() 中识别这个 标识符，然后用 <code>objParenContext-&gt;contextProperty(&quot;index&quot;).toString();</code> 找到 其上下文中的 <code>index</code> 属性。</p>
</li>
<li>
<p>该方法，进入 eventFilter() 时传入的 QObject 是信号的发出者，比如按键，若该按键控件见是被层层封装的，或者多个其它控件都封装了该按键控件，那么单看 eventFilter() 传入的 QObject 无法区分（该功用的按键控件在 eventFilter() 可以设置忽略掉），可通过找其 patent() 来区分，这就要求 其 patent 必须有 全局唯一的 id 或 objectName 属性。</p>
<p>有的共用按键封装了一层，比如 XButton（其 TapHandler 上一层 id 可设 <code>tapArea_track</code>），那么向上找一层 patent() 即可，有的共用按键封装了两层，那么需要向上找两层 patent()。</p>
<p>封装了两层的：XSwitchButton，XCheckBox。对于 XCheckBox，其 MouseArea 上一层 id 可设 <code>mouseArea_track</code>，其他同理。而 风扇控制的 XSwitchButton 又是在 ListView 里面，用如上同样的方法区分。</p>
<p>功用的按键等控件，设置有意义的 id，在 eventFilter() 里面识别 该控件需要网上找一层还是两层。</p>
</li>
</ul>
</li>
<li>
<p>重要注意，程序中会大量读取 QObject* 和 QQmlContext* 等信息，需要判断是否为空，不能对空指针操作，否则界面立即崩掉。</p>
</li>
</ul>
<p>例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// eventMonitor.h
</span><span class="c1"></span><span class="cp">#ifndef EVENTMONITOR_H
</span><span class="cp">#define EVENTMONITOR_H
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QObject&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QtQml&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QEvent&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QElapsedTimer&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QGuiApplication&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cm">/* 3 ways of usage
</span><span class="cm">   1 through &#34;rootObject&#34; of a qml file in main.cpp search its all eligible children QObject and add them eventFilter() one by one
</span><span class="cm">        but other aml file loaded by &#34;Loader&#34; is very complex to found:
</span><span class="cm">            https://stackoverflow.com/questions/36418941/accessing-qml-objects-from-loaded-qml-using-cpp-code
</span><span class="cm">        usage:
</span><span class="cm">            QObject* rootObjects = view.rootObject();
</span><span class="cm">            eventMonitor eventMonitor0(rootObjects, true);
</span><span class="cm">
</span><span class="cm">    2 add QApplication a eventFilter()
</span><span class="cm">        All events in the QT pass through here, posing a risk of performance congestion and security
</span><span class="cm">        add special process code to widget in eventFilter(), and the tracked widget need global unique &#34;id&#34;
</span><span class="cm">        usage: in main.cpp
</span><span class="cm">            eventMonitor eM;
</span><span class="cm">            eM.eM_installEventFilter(&amp;app);
</span><span class="cm">
</span><span class="cm">            or (recommend)
</span><span class="cm">                #if isUITrack_eM
</span><span class="cm">                    eventMonitor::inst().eM_installEventFilter(&amp;app);
</span><span class="cm">                #endif
</span><span class="cm">
</span><span class="cm">    3 QGuiApplication::notify() level event filter
</span><span class="cm">        All events in the QT pass through here, posing a risk of performance congestion and security
</span><span class="cm">        before use, in &#34;eventMonitor::eventMonitor(QObject* parent)&#34;, add &#34;QGuiApplication::instance()-&gt;installEventFilter(this);&#34;
</span><span class="cm">        usage
</span><span class="cm">            use &#34;eM_QGuiApplication app(argc, argv);&#34; insted of &#34;QGuiApplication app(argc, argv);&#34; in main.cpp
</span><span class="cm">*/</span>

<span class="cp">#define isUITrack_eM 1
</span><span class="cp"></span>
<span class="k">class</span> <span class="nc">eventMonitor</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>
<span class="k">public</span><span class="o">:</span>

    <span class="k">static</span> <span class="n">eventMonitor</span><span class="o">&amp;</span> <span class="n">inst</span><span class="p">();</span>
    <span class="k">explicit</span> <span class="nf">eventMonitor</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">);</span>

    <span class="k">explicit</span> <span class="nf">eventMonitor</span><span class="p">(</span><span class="n">QObject</span><span class="o">*</span> <span class="n">rootObject</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isEnable</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isPrintMsg</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isGiveObjName_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">);</span>
    <span class="o">~</span><span class="n">eventMonitor</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="nf">eM_installEventFilter</span><span class="p">(</span><span class="n">QObject</span><span class="o">*</span> <span class="n">installEventFilter_obj</span><span class="p">);</span>  <span class="c1">// &#34;eM&#34; is for &#34;eventMonitor&#34;
</span><span class="c1"></span>
    <span class="kt">void</span> <span class="nf">setEnableEventFilter</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isEnable</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">setPrintMsg</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isPrintMsg</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">setPrintPos</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isPrintPos</span><span class="p">);</span>

    <span class="kt">bool</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">QEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

<span class="nl">signals</span><span class="p">:</span>

<span class="k">public</span> <span class="nl">slots</span><span class="p">:</span>
    <span class="kt">void</span> <span class="n">sendTrackMsg</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">mainPageIndex</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">subPageIndex</span><span class="p">,</span> <span class="k">const</span> <span class="n">QString</span><span class="o">&amp;</span> <span class="n">objectID</span><span class="p">,</span> <span class="k">const</span> <span class="n">QString</span><span class="o">&amp;</span> <span class="n">arg</span><span class="p">);</span>

<span class="k">protected</span><span class="o">:</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">QObject</span><span class="o">*</span> <span class="n">installEventFilter_obj_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
    <span class="n">QObject</span><span class="o">*</span> <span class="n">rootObject_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">isEnable_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">isPrintMsg_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">isPrintPos_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">QElapsedTimer</span> <span class="n">elapsedTimer</span><span class="p">;</span>

    <span class="c1">// store page now at
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">mainPageIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 0~4 indicate main page index
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span> <span class="c1">// mainPageSubPageIndex[mainPageIndex] indicate sub page index
</span><span class="c1"></span>
    <span class="c1">// variables below that inside eventFilter()
</span><span class="c1"></span>    <span class="n">QEvent</span><span class="o">::</span><span class="n">Type</span> <span class="n">eM_eventType</span><span class="p">;</span>

    <span class="n">QObject</span><span class="o">*</span> <span class="n">eM_object</span><span class="p">;</span>
    <span class="n">QQmlContext</span><span class="o">*</span> <span class="n">eM_context</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">eM_objectId</span><span class="p">;</span>
<span class="c1">//    QString eM_objectName;
</span><span class="c1"></span>
    <span class="n">QObject</span><span class="o">*</span> <span class="n">eM_objParent</span><span class="p">;</span>
    <span class="n">QQmlContext</span><span class="o">*</span> <span class="n">eM_objParenContext</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">eM_objParentId</span><span class="p">;</span>

    <span class="n">QObject</span><span class="o">*</span> <span class="n">eM_objPp</span><span class="p">;</span>
    <span class="n">QQmlContext</span><span class="o">*</span> <span class="n">eM_objPpContext</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">eM_objPpId</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">eM_QGuiApplication</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QGuiApplication</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">eM_QGuiApplication</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]);</span>
    <span class="o">~</span><span class="n">eM_QGuiApplication</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="nf">notify</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">QEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

<span class="nl">signals</span><span class="p">:</span>
<span class="k">public</span> <span class="nl">slots</span><span class="p">:</span>
<span class="k">protected</span><span class="o">:</span>
<span class="k">private</span><span class="o">:</span>
<span class="p">};</span>

<span class="c1">//#define DEBUG_eventMonitor
</span><span class="c1">//#define DEBUG_PrintMsg
</span><span class="c1"></span>
<span class="cp">#endif </span><span class="c1">// EVENTMONITOR_H
</span><span class="c1"></span>


<span class="c1">// eventMonitor.cpp
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&#34;eventMonitor.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QDebug&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QCursor&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QPoint&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="n">eventMonitor</span><span class="o">&amp;</span> <span class="n">eventMonitor</span><span class="o">::</span><span class="n">inst</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">eventMonitor</span> <span class="n">eM</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">eM</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">eventMonitor</span><span class="o">::</span><span class="n">eventMonitor</span><span class="p">(</span><span class="n">QObject</span><span class="o">*</span> <span class="n">parent</span><span class="p">)</span>
  <span class="o">:</span> <span class="n">QObject</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef DEBUG_PrintMsg
</span><span class="cp"></span>    <span class="n">isPrintMsg_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="cp"></span><span class="c1">//    qDebug() &lt;&lt; &#34; --- eM: eventMonitor class constructor&#34;;
</span><span class="c1">//    QGuiApplication::instance()-&gt;installEventFilter(this);
</span><span class="c1"></span><span class="p">}</span>

<span class="n">eventMonitor</span><span class="o">::</span><span class="n">eventMonitor</span><span class="p">(</span><span class="n">QObject</span><span class="o">*</span> <span class="n">rootObject</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isEnable</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isPrintMsg</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isGiveObjName_</span><span class="p">,</span> <span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
  <span class="o">:</span> <span class="n">QObject</span><span class="p">(</span><span class="n">parent</span><span class="p">),</span>
    <span class="n">rootObject_</span><span class="p">(</span><span class="n">rootObject</span><span class="p">),</span>
    <span class="n">isEnable_</span><span class="p">(</span><span class="n">isEnable</span><span class="p">),</span>
    <span class="n">isPrintMsg_</span><span class="p">(</span><span class="n">isPrintMsg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rootObject_</span><span class="p">)</span> <span class="p">{</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: null rootObject&#34;</span><span class="p">;</span> <span class="k">return</span> <span class="p">;}</span>

    <span class="n">QObject</span><span class="o">*</span> <span class="n">object</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
    <span class="n">QQmlContext</span><span class="o">*</span> <span class="n">context</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">objectId</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">objectName</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">;</span>

    <span class="n">QList</span><span class="o">&lt;</span><span class="n">QObject</span><span class="o">*&gt;</span> <span class="n">rootChildren</span> <span class="o">=</span> <span class="n">rootObject_</span><span class="o">-&gt;</span><span class="n">findChildren</span><span class="o">&lt;</span><span class="n">QObject</span><span class="o">*&gt;</span><span class="p">();</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rootChildren</span><span class="p">.</span><span class="n">length</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">object</span> <span class="o">=</span> <span class="n">rootChildren</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">object</span><span class="p">)</span> <span class="p">{</span> <span class="k">continue</span> <span class="p">;}</span>

        <span class="c1">// get id
</span><span class="c1"></span>        <span class="n">context</span> <span class="o">=</span> <span class="n">QtQml</span><span class="o">::</span><span class="n">qmlContext</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
        <span class="n">objectId</span> <span class="o">=</span> <span class="n">context</span><span class="o">-&gt;</span><span class="n">nameForObject</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="s">&#34;&#34;</span> <span class="o">==</span> <span class="n">objectId</span><span class="p">)</span> <span class="p">{</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// qDebug() auto add &#39;\n&#39;, so use std::cout here
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: find Id: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">objectId</span><span class="p">.</span><span class="n">toStdString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;,&#34;</span><span class="p">;</span>

        <span class="n">objectName</span> <span class="o">=</span> <span class="n">object</span><span class="o">-&gt;</span><span class="n">objectName</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="s">&#34;&#34;</span> <span class="o">!=</span> <span class="n">objectName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; - find N: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">objectName</span><span class="p">.</span><span class="n">toStdString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// &#34;N&#34; is for &#34;Name&#34;
</span><span class="c1"></span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isGiveObjName_</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">objectName</span> <span class="o">=</span> <span class="n">objectId</span> <span class="o">+</span> <span class="s">&#34;_objName&#34;</span><span class="p">;</span>
                <span class="n">object</span><span class="o">-&gt;</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">objectName</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; - set N: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">objectName</span><span class="p">.</span><span class="n">toStdString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; - no N &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">object</span><span class="o">-&gt;</span><span class="n">installEventFilter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">eventMonitor</span><span class="o">::</span><span class="n">setEnableEventFilter</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isEnable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">isEnable_</span> <span class="o">=</span> <span class="n">isEnable</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">installEventFilter_obj_</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">isEnable_</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">installEventFilter_obj_</span><span class="o">-&gt;</span><span class="n">installEventFilter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">installEventFilter_obj_</span><span class="o">-&gt;</span><span class="n">removeEventFilter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">eventMonitor</span><span class="o">::</span><span class="n">setPrintMsg</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isPrintMsg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">isPrintMsg_</span> <span class="o">=</span> <span class="n">isPrintMsg</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">eventMonitor</span><span class="o">::</span><span class="n">setPrintPos</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isPrintPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">isPrintPos_</span> <span class="o">=</span> <span class="n">isPrintPos</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">eventMonitor</span><span class="o">::</span><span class="n">eM_installEventFilter</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">installEventFilter_obj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">installEventFilter_obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">installEventFilter_obj_</span>  <span class="o">=</span> <span class="n">installEventFilter_obj</span><span class="p">;</span>
        <span class="n">installEventFilter_obj_</span><span class="o">-&gt;</span><span class="n">installEventFilter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">eventMonitor</span><span class="o">::~</span><span class="n">eventMonitor</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">installEventFilter_obj_</span><span class="o">-&gt;</span><span class="n">removeEventFilter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="n">elapsedTimer</span><span class="p">.</span><span class="n">invalidate</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* track and ID definition shall be clear in a doc somewhere
</span><span class="cm">    Measure the average runtime of this function to be 0.35ms, not much CPU usage
</span><span class="cm">*/</span>
<span class="kt">bool</span> <span class="n">eventMonitor</span><span class="o">::</span><span class="n">eventFilter</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">QEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">isEnable_</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">obj</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">event</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">eM_eventType</span> <span class="o">=</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">();</span>
<span class="c1">//    int eventType_int = static_cast&lt;int&gt;(eM_eventType); not used
</span><span class="c1"></span>
<span class="c1">//    if(QEvent::KeyPress == eM_eventType) /* key, 6 */
</span><span class="c1">//    { if(isPrintMsg_) qDebug() &lt;&lt; &#34; --- eM: key&#34;; return false;}
</span><span class="c1"></span>
    <span class="k">if</span><span class="p">(</span><span class="n">QEvent</span><span class="o">::</span><span class="n">LanguageChange</span> <span class="o">==</span> <span class="n">eM_eventType</span><span class="p">)</span> <span class="cm">/* LanguageChange, 89 */</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: languageChange&#34;</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- lang&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">QString</span><span class="p">(</span><span class="n">XXX</span><span class="p">.</span><span class="n">language</span><span class="p">());</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="s">&#34;LanguageChange&#34;</span><span class="p">,</span> \
                     <span class="n">QString</span><span class="p">(</span><span class="n">XXX</span><span class="p">.</span><span class="n">language</span><span class="p">()));</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

<span class="cp">#ifdef Q_OS_WIN
</span><span class="cp"></span>    <span class="k">if</span><span class="p">(</span>    <span class="p">(</span><span class="n">QEvent</span><span class="o">::</span><span class="n">MouseButtonPress</span> <span class="o">==</span> <span class="n">eM_eventType</span><span class="p">)</span> <span class="cm">/* MouseButtonPress, 2 */</span>
<span class="c1">//        || (QEvent::FocusIn == eM_eventType)        /* input software keyboard, 8, not stable, not used */
</span><span class="c1"></span>      <span class="p">)</span>
<span class="cp">#endif
</span><span class="cp"></span>
<span class="cp">#ifdef Q_OS_LINUX
</span><span class="cp"></span>        <span class="k">if</span><span class="p">(</span>    <span class="p">(</span><span class="n">QEvent</span><span class="o">::</span><span class="n">TouchBegin</span> <span class="o">==</span> <span class="n">eM_eventType</span><span class="p">)</span>     <span class="cm">/* TouchBegin, 194 */</span>
            <span class="o">||</span> <span class="p">(</span><span class="n">QEvent</span><span class="o">::</span><span class="n">HoverEnter</span> <span class="o">==</span> <span class="n">eM_eventType</span><span class="p">)</span>     <span class="cm">/* HoverEnter, 127, response &#34;TapHandler&#34; in qml, its occur this event*/</span>
            <span class="o">||</span> <span class="p">(</span><span class="n">QEvent</span><span class="o">::</span><span class="n">HoverMove</span>  <span class="o">==</span> <span class="n">eM_eventType</span><span class="p">)</span>     <span class="cm">/* HoverEnter, 129, response &#34;TapHandler&#34; in qml */</span>
          <span class="p">)</span>
<span class="cp">#endif
</span><span class="cp"></span>    <span class="p">{</span>

    <span class="n">eM_object</span> <span class="o">=</span> <span class="n">obj</span><span class="p">;</span>

    <span class="c1">// get id
</span><span class="c1"></span>    <span class="n">eM_context</span> <span class="o">=</span> <span class="n">QtQml</span><span class="o">::</span><span class="n">qmlContext</span><span class="p">(</span><span class="n">eM_object</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_context</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">eM_objectId</span> <span class="o">=</span> <span class="n">eM_context</span><span class="o">-&gt;</span><span class="n">nameForObject</span><span class="p">(</span><span class="n">eM_object</span><span class="p">);</span>
    <span class="c1">// get objectName
</span><span class="c1">//    eM_objectName = eM_object-&gt;objectName(); not used
</span><span class="c1"></span>
    <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>

<span class="cp">#ifndef DEBUG_eventMonitor
</span><span class="cp"></span>    <span class="c1">// the event sender`s ID must contains &#34;track&#34;!
</span><span class="c1"></span>    <span class="c1">// such as &#34;id: mouseArea_track&#34; in XCheckBox.qml and XSwitchButton.qml
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_objectId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;track&#34;</span><span class="p">))</span> <span class="p">{</span><span class="k">return</span> <span class="nb">false</span><span class="p">;}</span>

    <span class="c1">// choise, need &#34;onjectName&#34; property, be same as ID
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">eM_objectId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;choise_tapArea_track&#34;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// test cannot read its ID, use &#34;onjectName&#34; insted
</span><span class="c1"></span>        <span class="n">QString</span> <span class="n">choise_id</span> <span class="o">=</span> <span class="n">eM_context</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;choise_objName&#34;</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">choise_id</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;track&#34;</span><span class="p">))</span> <span class="p">{</span><span class="k">return</span> <span class="nb">false</span><span class="p">;}</span>
        <span class="c1">// get its &#34;index&#34; to know which item is choiced
</span><span class="c1"></span>        <span class="n">index</span> <span class="o">=</span> <span class="n">eM_context</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;index&#34;</span><span class="p">).</span><span class="n">toInt</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: choise Id&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">choise_id</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- index&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">index</span><span class="p">;</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="n">choise_id</span><span class="p">,</span> <span class="n">QString</span><span class="o">::</span><span class="n">number</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span>
    <span class="c1">// find its parent
</span><span class="c1"></span>    <span class="n">eM_objParent</span> <span class="o">=</span> <span class="n">eM_object</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_objParent</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*qDebug() &lt;&lt; &#34; --- eM: !objParent&#34;;*/</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;}</span>

    <span class="n">eM_objParenContext</span> <span class="o">=</span> <span class="n">QtQml</span><span class="o">::</span><span class="n">qmlContext</span><span class="p">(</span><span class="n">eM_objParent</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_objParenContext</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*qDebug() &lt;&lt; &#34; --- eM: !objParenContext&#34;;*/</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="p">}</span>

    <span class="n">eM_objParentId</span> <span class="o">=</span> <span class="n">eM_objParenContext</span><span class="o">-&gt;</span><span class="n">nameForObject</span><span class="p">(</span><span class="n">eM_objParent</span><span class="p">);</span>

<span class="cp">#ifdef DEBUG_eventMonitor
</span><span class="cp"></span>    <span class="c1">// for debug
</span><span class="c1"></span>    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --------------- eM: Id&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_objectId</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- pID&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_objParentId</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- eT&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_eventType</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="cp"></span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;track&#34;</span><span class="p">))</span> <span class="p">{</span><span class="k">return</span> <span class="nb">false</span><span class="p">;}</span>

    <span class="c1">// get page
</span><span class="c1"></span>    <span class="c1">// find btn in ListView of &#34;Navigator&#34; or &#34;BasePage&#34;
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xb_listviewZb_nav_track&#34;</span><span class="p">))</span> <span class="c1">// in Navigator.qml
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="c1">// read its &#34;index&#34; property to locate which btn in a ListView
</span><span class="c1"></span>        <span class="n">mainPageIndex</span> <span class="o">=</span> <span class="n">eM_objParenContext</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;index&#34;</span><span class="p">).</span><span class="n">toInt</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span>
            <span class="n">mainPageIndex</span> <span class="o">?</span> <span class="p">(</span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: page switch&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageIndex</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">])</span> \
                <span class="o">:</span> <span class="p">(</span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: page switch&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageIndex</span><span class="p">)</span> <span class="p">;</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="s">&#34;pageSwitch&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xb_listviewZb_subTab_track&#34;</span><span class="p">))</span> <span class="c1">// in BasePage.qml
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">eM_objParenContext</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;index&#34;</span><span class="p">).</span><span class="n">toInt</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span>
            <span class="n">mainPageIndex</span> <span class="o">?</span> <span class="p">(</span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: page switch&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageIndex</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">])</span> \
                <span class="o">:</span> <span class="p">(</span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: page switch&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageIndex</span><span class="p">)</span> <span class="p">;</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="s">&#34;pageSwitch&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// process specific type qml widget
</span><span class="c1"></span>
    <span class="c1">// its parent`s parent is the tracked id
</span><span class="c1"></span>    <span class="c1">// XCheckBox.qml and XSwitchButton.qml
</span><span class="c1"></span>    <span class="c1">// get &#34;checked&#34; to know its state
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span>    <span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xcheckBox_mouseArea_track&#34;</span><span class="p">)</span>
        <span class="o">||</span> <span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xswitchButton_mouseArea_track&#34;</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">eM_objPp</span> <span class="o">=</span> <span class="n">eM_objParent</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_objPp</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">eM_objPpContext</span> <span class="o">=</span> <span class="n">QtQml</span><span class="o">::</span><span class="n">qmlContext</span><span class="p">(</span><span class="n">eM_objPp</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_objPpContext</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">eM_objPpId</span> <span class="o">=</span> <span class="n">eM_objPpContext</span><span class="o">-&gt;</span><span class="n">nameForObject</span><span class="p">(</span><span class="n">eM_objPp</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">eM_objPpId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;track&#34;</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// get &#34;checked&#34; to know it state
</span><span class="c1"></span>            <span class="k">static</span> <span class="kt">bool</span> <span class="n">last_checked</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="kt">bool</span> <span class="n">checked</span> <span class="o">=</span> <span class="n">eM_context</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;checked&#34;</span><span class="p">).</span><span class="n">toBool</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="n">checked</span> <span class="o">!=</span> <span class="n">last_checked</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">eM_objPpId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;listview&#34;</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">eM_objPpContext</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;index&#34;</span><span class="p">).</span><span class="n">toInt</span><span class="p">();</span>
                    <span class="n">eM_objPpId</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#34;_&#34;</span> <span class="o">+</span> <span class="n">QString</span><span class="o">::</span><span class="n">number</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
                <span class="p">}</span>
                <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: ppId&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_objPpId</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- checked&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">last_checked</span><span class="p">;</span>
                <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="n">eM_objPpId</span><span class="p">,</span> <span class="n">last_checked</span> <span class="o">?</span> <span class="s">&#34;1&#34;</span> <span class="o">:</span> <span class="s">&#34;0&#34;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">last_checked</span> <span class="o">=</span> <span class="n">checked</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// its parent`s parent is the tracked id
</span><span class="c1"></span>    <span class="c1">// SimplePaging.qml, downBtn
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xb_pagerDown_track&#34;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">eM_objPp</span> <span class="o">=</span> <span class="n">eM_objParent</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_objPp</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">eM_objPpContext</span> <span class="o">=</span> <span class="n">QtQml</span><span class="o">::</span><span class="n">qmlContext</span><span class="p">(</span><span class="n">eM_objPp</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">eM_objPpContext</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">eM_objPpId</span> <span class="o">=</span> <span class="n">eM_objPpContext</span><span class="o">-&gt;</span><span class="n">nameForObject</span><span class="p">(</span><span class="n">eM_objPp</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">eM_objPpId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;track&#34;</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: pager downBtn ppId&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_objPpId</span><span class="p">;</span>
            <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="n">eM_objPpId</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Dialog.qml
</span><span class="c1"></span>    <span class="c1">// read its &#34;index&#34; get which btn(no need for now)
</span><span class="c1"></span>    <span class="c1">// read its &#34;modelData.name&#34;(not work, actually use &#34;name&#34;) get &#34;buttons.name&#34; to know btn type
</span><span class="c1"></span>    <span class="c1">// read its &#34;dialog_errorMsg&#34; or &#34;dialog_text&#34; property get dialog msg, to distinguish unique dialog
</span><span class="c1"></span>    <span class="c1">// &#34;dialog_errorMsg&#34; and &#34;dialog_text&#34; choose one not null to send
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xb_listview_dialog_track&#34;</span><span class="p">))</span>
    <span class="p">{</span>
<span class="c1">//        index = eM_objParenContext-&gt;contextProperty(&#34;index&#34;).toInt(); no need
</span><span class="c1">//        eM_objParentId.append(&#34;_&#34; + QString::number(index));
</span><span class="c1"></span>        <span class="n">QString</span> <span class="n">dialog_btn_name</span> <span class="o">=</span>   <span class="n">eM_objParenContext</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
        <span class="n">QString</span> <span class="n">dialog_xxxFinishTitle</span>    <span class="o">=</span>   <span class="n">eM_objParenContext</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;dialog_xxxFinishTitle&#34;</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
        <span class="n">QString</span> <span class="n">dialog_errorMsg</span> <span class="o">=</span>   <span class="n">eM_objParenContext</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;dialog_errorMsg&#34;</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
        <span class="n">QString</span> <span class="n">dialog_text</span>     <span class="o">=</span>   <span class="n">eM_objParenContext</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;dialog_text&#34;</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: dialog - pId&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_objParentId</span> \
                                 <span class="o">&lt;&lt;</span> <span class="s">&#34;- btn&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">dialog_btn_name</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- title&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">dialog_xxxFinishTitle</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;. - dialog_errorMsg&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">dialog_errorMsg</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- dialog_text&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">dialog_text</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dialog_errorMsg</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="s">&#34;dialog_track&#34;</span><span class="p">,</span> \
                         <span class="n">dialog_btn_name</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span> <span class="o">+</span> <span class="n">dialog_xxxFinishTitle</span> <span class="o">+</span> <span class="s">&#34;.&#34;</span> <span class="o">+</span> <span class="n">dialog_errorMsg</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="s">&#34;dialog_track&#34;</span><span class="p">,</span> <span class="n">dialog_btn_name</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span> <span class="o">+</span> <span class="n">dialog_xxxFinishTitle</span> <span class="o">+</span> <span class="s">&#34;.&#34;</span> <span class="o">+</span> <span class="n">dialog_text</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// XButton, its parent is the tracked id
</span><span class="c1"></span>    <span class="c1">// XButton.qml use &#34;TapHandler&#34;, but its parent emit event, if its parent named with &#34;xb_&#34; and &#34;track&#34;(above checked)
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xb_&#34;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">eM_objParentId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;listview&#34;</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// get &#34;index&#34; propertys to know which one
</span><span class="c1"></span>            <span class="n">index</span> <span class="o">=</span> <span class="n">eM_objParenContext</span><span class="o">-&gt;</span><span class="n">contextProperty</span><span class="p">(</span><span class="s">&#34;index&#34;</span><span class="p">).</span><span class="n">toInt</span><span class="p">();</span>
            <span class="n">eM_objParentId</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#34;_&#34;</span> <span class="o">+</span> <span class="n">QString</span><span class="o">::</span><span class="n">number</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
            <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: xbutton in listview - pId&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_objParentId</span><span class="p">;</span>
            <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="n">eM_objParentId</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: xbutton - pId&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_objParentId</span><span class="p">;</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="n">eM_objParentId</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// XButton, its parent is the tracked id
</span><span class="c1"></span>    <span class="c1">// XButton.qml use &#34;TapHandler&#34;, but its parent emit event
</span><span class="c1"></span>    <span class="c1">// XButton, but it defined MouseArea(), such as &#34;xb_P00_goto_track&#34;
</span><span class="c1"></span>    <span class="k">if</span><span class="p">((</span><span class="s">&#34;xbutton_tapArea_track&#34;</span> <span class="o">==</span> <span class="n">eM_objectId</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: xbutton pId&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">eM_objParentId</span><span class="p">;</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="n">eM_objParentId</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// choise, itself is the tracked id
</span><span class="c1"></span>    <span class="c1">// choise process above in &#34;if(eM_objectId.contains(&#34;choise_tapArea_track&#34;))&#34;
</span><span class="c1">//    if(eM_objectId.contains(&#34;ch_&#34;) &amp;&amp; eM_objectId.contains(&#34;track&#34;)) // Choise id
</span><span class="c1">//    {
</span><span class="c1">//        // get its &#34;currentIndex&#34; to know which item is choiced
</span><span class="c1">//        index = eM_context-&gt;contextProperty(&#34;currentIndex&#34;).toInt();
</span><span class="c1">//        if(isPrintMsg_) qDebug() &lt;&lt; &#34; --- eM: choise Id&#34; &lt;&lt; eM_objectId &lt;&lt; &#34;- index&#34; &lt;&lt; index;
</span><span class="c1">//        sendTrackMsg(mainPageIndex, mainPageSubPageIndex[mainPageIndex], eM_objParentId, QString::number(index));
</span><span class="c1">//        return false;
</span><span class="c1">//    }
</span><span class="c1"></span>
    <span class="c1">// for debug
</span><span class="c1">//    if(isPrintMsg_) qDebug() &lt;&lt; &#34; --- eM: other Id&#34; &lt;&lt; eM_objectId &lt;&lt; &#34;- pID&#34; &lt;&lt; eM_objParentId;
</span><span class="c1"></span>
    <span class="k">if</span><span class="p">(</span><span class="n">isPrintPos_</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: pos&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">QCursor</span><span class="o">::</span><span class="n">pos</span><span class="p">().</span><span class="n">x</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">QCursor</span><span class="o">::</span><span class="n">pos</span><span class="p">().</span><span class="n">y</span><span class="p">();</span> <span class="p">}</span>

    <span class="p">}</span>

    <span class="c1">// continue the event propagation
</span><span class="c1"></span>    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">eM_QGuiApplication</span><span class="o">::</span><span class="n">eM_QGuiApplication</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
    <span class="o">:</span> <span class="n">QGuiApplication</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">eM_QGuiApplication</span><span class="o">::~</span><span class="n">eM_QGuiApplication</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">eM_QGuiApplication</span><span class="o">::</span><span class="n">notify</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">QEvent</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">eventMonitor</span><span class="o">::</span><span class="n">inst</span><span class="p">().</span><span class="n">eventFilter</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">QGuiApplication</span><span class="o">::</span><span class="n">notify</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* track and ID definition shall be clear in a doc somewhere
</span><span class="cm">    sendTrackMsg() will send json msg to &#34;xxx/log/xxxtracker/xxxtrack_log.xx&#34;
</span><span class="cm">    the process &#34;xxxtracker&#34; in AP will periodically(such as 8h) send its to cloud to visualization data
</span><span class="cm">*/</span>
<span class="kt">void</span> <span class="n">eventMonitor</span><span class="o">::</span><span class="n">sendTrackMsg</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">pageIndex</span><span class="p">,</span> <span class="k">const</span> <span class="n">QString</span><span class="o">&amp;</span> <span class="n">objectID</span><span class="p">,</span> <span class="k">const</span> <span class="n">QString</span><span class="o">&amp;</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">elapsedTimer</span><span class="p">.</span><span class="n">restart</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: sendTrackMsg() - page&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">pageIndex</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- ID&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">objectID</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- arg&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">arg</span><span class="p">;</span>
    <span class="n">QVariantMap</span> <span class="n">trackMsgContent</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="s">&#34;State&#34;</span><span class="p">,</span> <span class="n">xxx</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">()},</span>
        <span class="p">{</span><span class="s">&#34;pageIndex&#34;</span><span class="p">,</span> <span class="n">pageIndex</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;objectID&#34;</span><span class="p">,</span> <span class="n">objectID</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;arg&#34;</span><span class="p">,</span> <span class="n">arg</span><span class="p">}</span>
    <span class="p">};</span>
    <span class="n">XXX</span><span class="p">.</span><span class="n">sendTrackerMsg</span><span class="p">(</span><span class="s">&#34;XXX_Track&#34;</span><span class="p">,</span> <span class="n">trackMsgContent</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="qml-附加属性">QML 附加属性</h4>
<p>c++ 端添加附加属性，就是 qml 里面任何控件里面直接访问一个类（作为附加属性）的方法和读写其变量</p>
<p><a href="https://stackoverflow.com/questions/14537193/attached-properties-in-qml">https://stackoverflow.com/questions/14537193/attached-properties-in-qml</a></p>
<p>​	这个里面也提到，可以 <code>viewer-&gt;rootContext()-&gt;setContextProperty(&quot;MyPropClass&quot;, &amp;myProp);</code> 来让 qml 全局可以访问 MyPropClass。</p>
<p><a href="https://www.jianshu.com/p/36ea29750398">https://www.jianshu.com/p/36ea29750398</a></p>
<p><a href="https://blog.csdn.net/gongjianbo1992/article/details/102029750">https://blog.csdn.net/gongjianbo1992/article/details/102029750</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// eM_qmlAttachedProperties.h
</span><span class="c1"></span><span class="cp">#ifndef Track_H
</span><span class="cp">#define Track_H
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QObject&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QtQml&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QElapsedTimer&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QQmlEngine&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cm">/* refer    https://stackoverflow.com/questions/14537193/attached-properties-in-qml
</span><span class="cm">            https://www.jianshu.com/p/36ea29750398
</span><span class="cm">            https://blog.csdn.net/gongjianbo1992/article/details/102029750
</span><span class="cm"> * usage:
</span><span class="cm">    in main() and before load qml
</span><span class="cm">            qmlRegisterUncreatableType&lt;Track&gt;(&#34;Track&#34;, 1, 0, &#34;Tk&#34;, \
</span><span class="cm">                &#34; --- eM_qAP: This is an abstract type that is only available as an attached property.&#34;);
</span><span class="cm">        or
</span><span class="cm">            #if isUITrack_eM_qAP
</span><span class="cm">                Track::inst().Track_init(&#34;Track&#34;, &#34;Tk&#34;);
</span><span class="cm">            #endif
</span><span class="cm">
</span><span class="cm">    in qml, for example: see &#34;Track::processCaptureThings()&#34; for detail
</span><span class="cm">        in &#34;Tk.c&#34;, must have &#34;id&#34; key and its string value must have &#34;track&#34;
</span><span class="cm">
</span><span class="cm">        import Track 1.0
</span><span class="cm">
</span><span class="cm">        xButton {
</span><span class="cm">            id: xb_P00_XXXCtrl_track
</span><span class="cm">            objectName: &#34;xb_P00_XXXCtrl_track&#34; // keep it as same as id
</span><span class="cm">            ...
</span><span class="cm">            onClicked: {
</span><span class="cm">                Tk.c = {&#34;id&#34;: objectName}
</span><span class="cm">                or
</span><span class="cm">                Tk.c = {&#34;id&#34;: &#34;xb_P00_XXXCtrl_track&#34;, &#34;info&#34;: &#34;&#34;}
</span><span class="cm">                or
</span><span class="cm">                var str = string(&#34;key:%1, key2:%2&#34;).arg().arg()
</span><span class="cm">                Tk.c = {&#34;id&#34;: &#34;xb_P00_XXXCtrl_track&#34;, &#34;info&#34;: str}
</span><span class="cm">            }
</span><span class="cm">        }
</span><span class="cm">
</span><span class="cm">        Choise {
</span><span class="cm">            id: XXXLevelCh
</span><span class="cm">            ...
</span><span class="cm">            onCurrentIndexChanged: {
</span><span class="cm">                Tk.c = {&#34;id&#34;: &#34;XXXLevelCh&#34;, &#34;currentIndex&#34;: currentIndex}
</span><span class="cm">            }
</span><span class="cm">        }
</span><span class="cm">
</span><span class="cm">        ZCheckBox {
</span><span class="cm">            id: xcb_P13_XX_track
</span><span class="cm">            ...
</span><span class="cm">            onToggled: {
</span><span class="cm">                Tk.c = {&#34;id&#34;: &#34;xcb_P13_XX_track&#34;, &#34;checked&#34;: checked}
</span><span class="cm">            }
</span><span class="cm">        }
</span><span class="cm">
</span><span class="cm">    for widget in listview: msuh have &#34;id&#34; and &#34;index&#34;
</span><span class="cm">        XButton {
</span><span class="cm">            id: xb_listview_P10_XXX_track
</span><span class="cm">            ...
</span><span class="cm">            onClicked: {
</span><span class="cm">                Tk.c = {&#34;id&#34;: &#34;xb_listview_P10_XXX_track&#34;, &#34;index&#34;: index}
</span><span class="cm">            }
</span><span class="cm">
</span><span class="cm">        XSwitchButton {
</span><span class="cm">            id: xsw_listview_P10_XXX_track
</span><span class="cm">            ...
</span><span class="cm">            onToggled: {
</span><span class="cm">                Tk.c = {
</span><span class="cm">                    &#34;id&#34;: &#34;xsw_listview_P10_XXX_track&#34;,
</span><span class="cm">                    &#34;index&#34;: index,
</span><span class="cm">                    &#34;checked&#34;: checked }
</span><span class="cm">            }
</span><span class="cm">        }
</span><span class="cm">*/</span>

<span class="cp">#define isUITrack_eM_qAP 1
</span><span class="cp"></span>
<span class="k">class</span> <span class="nc">Track</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QVariantMap</span> <span class="n">c</span> <span class="n">READ</span> <span class="n">captureThings</span> <span class="n">WRITE</span> <span class="n">setSaptureThings</span><span class="p">)</span>
    <span class="n">Q_INVOKABLE</span> <span class="kt">void</span> <span class="n">setTrackisEnable</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isEnable</span><span class="p">);</span>

    <span class="k">explicit</span> <span class="nf">Track</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">);</span>
    <span class="o">~</span><span class="n">Track</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">Track</span><span class="o">&amp;</span> <span class="n">inst</span><span class="p">();</span>
    <span class="k">static</span> <span class="n">Track</span><span class="o">*</span> <span class="nf">qmlAttachedProperties</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">object</span><span class="p">);</span> <span class="c1">// this class as Attached Properties
</span><span class="c1"></span>
    <span class="kt">void</span> <span class="nf">Track_init</span><span class="p">(</span><span class="n">QString</span> <span class="n">libName</span><span class="p">,</span> <span class="n">QString</span> <span class="n">itemName</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">setEnableQAP</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isEnable</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">setPrintMsg</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isPrintMsg</span><span class="p">);</span>

    <span class="n">QVariantMap</span><span class="o">&amp;</span> <span class="n">captureThings</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">setSaptureThings</span><span class="p">(</span><span class="k">const</span> <span class="n">QVariantMap</span><span class="o">&amp;</span> <span class="n">things</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">processCaptureThings</span><span class="p">();</span>

<span class="nl">signals</span><span class="p">:</span>
<span class="k">public</span> <span class="nl">slots</span><span class="p">:</span>
    <span class="n">Q_INVOKABLE</span> <span class="kt">void</span> <span class="n">sendTrackMsg</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">mainPageIndex</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">subPageIndex</span><span class="p">,</span> <span class="k">const</span> <span class="n">QString</span><span class="o">&amp;</span> <span class="n">objectID</span><span class="p">,</span> <span class="k">const</span> <span class="n">QVariantMap</span><span class="o">&amp;</span> <span class="n">arg</span><span class="p">);</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">QVariantMap</span> <span class="n">captureThings_</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">isEnable_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">isPrintMsg_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">QElapsedTimer</span> <span class="n">elapsedTimer</span><span class="p">;</span>

    <span class="n">QObject</span><span class="o">*</span> <span class="n">captureObject</span><span class="p">;</span> <span class="c1">// from &#34;object&#34; of qmlAttachedProperties(QObject *object)
</span><span class="c1">//    QQmlContext* captureContext;
</span><span class="c1"></span>    <span class="n">QString</span> <span class="n">captureObjectId</span><span class="p">;</span>

    <span class="c1">// json key deinfe
</span><span class="c1"></span>    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_id</span>            <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_info</span>          <span class="o">=</span> <span class="s">&#34;info&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_index</span>         <span class="o">=</span> <span class="s">&#34;index&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_checked</span>       <span class="o">=</span> <span class="s">&#34;checked&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_currentIndex</span>  <span class="o">=</span> <span class="s">&#34;currentIndex&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_argExtra</span>      <span class="o">=</span> <span class="s">&#34;argExtra&#34;</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_dialog_btn</span>    <span class="o">=</span> <span class="s">&#34;dialog_btn&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_dialog_text</span>   <span class="o">=</span> <span class="s">&#34;dialog_text&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_hms_btn</span>       <span class="o">=</span> <span class="s">&#34;hms_btn&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_hms_text</span>      <span class="o">=</span> <span class="s">&#34;hms_text&#34;</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">QString</span> <span class="n">key_lang</span>          <span class="o">=</span> <span class="s">&#34;lang&#34;</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Makes the type Track known to QMetaType (for using with QVariant)
</span><span class="c1"></span><span class="n">QML_DECLARE_TYPE</span><span class="p">(</span><span class="n">Track</span><span class="p">)</span>
<span class="c1">// declares that the Track supports attached properties.
</span><span class="c1"></span><span class="n">QML_DECLARE_TYPEINFO</span><span class="p">(</span><span class="n">Track</span><span class="p">,</span> <span class="n">QML_HAS_ATTACHED_PROPERTIES</span><span class="p">)</span>

<span class="cp">#endif </span><span class="c1">// Track_H
</span><span class="c1"></span>

<span class="c1">// eM_qmlAttachedProperties.cpp
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&#34;Track.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QDebug&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="n">Track</span><span class="o">::</span><span class="n">Track</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span> <span class="o">:</span> <span class="n">QObject</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
<span class="c1">//    qDebug() &lt;&lt; &#34; --- eM_qAP: Track class constructor&#34;;
</span><span class="c1"></span><span class="p">}</span>

<span class="n">Track</span><span class="o">::~</span><span class="n">Track</span><span class="p">()</span>
<span class="p">{</span>
<span class="c1">//    qDebug() &lt;&lt; &#34; --- eM_qAP: ~Track class destructor &#34;;
</span><span class="c1"></span>    <span class="n">elapsedTimer</span><span class="p">.</span><span class="n">invalidate</span><span class="p">();</span>
    <span class="n">isEnable_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">captureThings_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">Track</span><span class="o">&amp;</span> <span class="n">Track</span><span class="o">::</span><span class="n">inst</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">Track</span> <span class="n">eM_qAP</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">eM_qAP</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// run once when exec &#34;Tk.c = {...}&#34; in a different item in qml
</span><span class="c1"></span><span class="n">Track</span><span class="o">*</span> <span class="n">Track</span><span class="o">::</span><span class="n">qmlAttachedProperties</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">object</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">inst</span><span class="p">().</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM_qAP: qmlAttachedProperties()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">object</span><span class="p">;</span>
    <span class="n">inst</span><span class="p">().</span><span class="n">captureObject</span> <span class="o">=</span> <span class="n">object</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">inst</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Track</span><span class="o">::</span><span class="n">Track_init</span><span class="p">(</span><span class="n">QString</span> <span class="n">libName</span><span class="p">,</span> <span class="n">QString</span> <span class="n">itemName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">qmlRegisterUncreatableType</span><span class="o">&lt;</span><span class="n">Track</span><span class="o">&gt;</span><span class="p">(</span><span class="n">libName</span><span class="p">.</span><span class="n">toStdString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">itemName</span><span class="p">.</span><span class="n">toStdString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> \
        <span class="s">&#34; --- eM_qAP: This is an abstract type that is only available as an attached property.&#34;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Track</span><span class="o">::</span><span class="n">setEnableQAP</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isEnable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">isEnable_</span> <span class="o">=</span> <span class="n">isEnable</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Track</span><span class="o">::</span><span class="n">setPrintMsg</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isPrintMsg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">isPrintMsg_</span> <span class="o">=</span> <span class="n">isPrintMsg</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Track</span><span class="o">::</span><span class="n">setTrackisEnable</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isEnable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">isEnable_</span> <span class="o">=</span> <span class="n">isEnable</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QVariantMap</span><span class="o">&amp;</span> <span class="n">Track</span><span class="o">::</span><span class="n">captureThings</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">captureThings_</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// run every time when exec &#34;EM_qAPItem.captureThings = {...}&#34; in qml
</span><span class="c1"></span><span class="kt">void</span> <span class="n">Track</span><span class="o">::</span><span class="n">setSaptureThings</span><span class="p">(</span><span class="k">const</span> <span class="n">QVariantMap</span><span class="o">&amp;</span> <span class="n">things</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">captureThings_</span> <span class="o">=</span> <span class="n">things</span><span class="p">;</span>
    <span class="n">processCaptureThings</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Track</span><span class="o">::</span><span class="n">processCaptureThings</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">isEnable_</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">captureObject</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>

    <span class="c1">// must have &#34;id&#34;
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">captureThings_</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">key_id</span><span class="p">))</span> <span class="k">return</span> <span class="p">;</span>

    <span class="n">captureObjectId</span> <span class="o">=</span> <span class="n">captureThings_</span><span class="p">[</span><span class="n">key_id</span><span class="p">].</span><span class="n">toString</span><span class="p">();</span>
    <span class="c1">// string value of key &#34;id&#34; must have &#34;track&#34;
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">captureObjectId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;track&#34;</span><span class="p">))</span> <span class="k">return</span> <span class="p">;</span>

    <span class="c1">// store page now at
</span><span class="c1"></span>    <span class="k">static</span> <span class="kt">int</span> <span class="n">mainPageIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 0~4 indicate main page index
</span><span class="c1"></span>    <span class="k">static</span> <span class="kt">int</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span> <span class="c1">// mainPageSubPageIndex[mainPageIndex] indicate sub page index
</span><span class="c1"></span>
    <span class="c1">// get page
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">captureObjectId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xb_listview_xxx_track&#34;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// read its &#34;index&#34; property to locate which btn in a ListView
</span><span class="c1"></span>        <span class="n">mainPageIndex</span> <span class="o">=</span> <span class="n">captureThings_</span><span class="p">[</span><span class="n">key_index</span><span class="p">].</span><span class="n">toInt</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span>
            <span class="n">mainPageIndex</span> <span class="o">?</span> <span class="p">(</span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM_qAP: page switch&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageIndex</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">])</span> \
                <span class="o">:</span> <span class="p">(</span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM_qAP: page switch&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageIndex</span><span class="p">)</span> <span class="p">;</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="s">&#34;pageSwitch&#34;</span><span class="p">,</span> <span class="p">{});</span>
        <span class="k">return</span> <span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">captureObjectId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;xb_listview_xxx_track&#34;</span><span class="p">))</span> <span class="c1">// in BaseTabPage.qml
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">captureThings_</span><span class="p">[</span><span class="n">key_index</span><span class="p">].</span><span class="n">toInt</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span>
            <span class="n">mainPageIndex</span> <span class="o">?</span> <span class="p">(</span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM_qAP: page switch&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageIndex</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">])</span> \
                <span class="o">:</span> <span class="p">(</span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM_qAP: page switch&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">mainPageIndex</span><span class="p">)</span> <span class="p">;</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="s">&#34;pageSwitch&#34;</span><span class="p">,</span> <span class="p">{});</span>
        <span class="k">return</span> <span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// language change
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">captureObjectId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;LanguageChange_track&#34;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM_qAP: languageChange&#34;</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- lang&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">[</span><span class="n">key_lang</span><span class="p">].</span><span class="n">toString</span><span class="p">();</span>
        <span class="n">captureThings_</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key_id</span><span class="p">);</span>
        <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="s">&#34;LanguageChange&#34;</span><span class="p">,</span> <span class="n">captureThings_</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">captureObjectId</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;listview&#34;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">key_index</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">captureObjectId</span> <span class="o">=</span> <span class="n">captureObjectId</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#34;_&#34;</span> <span class="o">+</span> <span class="n">captureThings_</span><span class="p">[</span><span class="n">key_index</span><span class="p">].</span><span class="n">toString</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">// get id, not used because for choise it come out others id, use &#34;captureThings_.value(&#34;info&#34;).toString()&#34; instead
</span><span class="c1">//    captureContext = QtQml::qmlContext(captureObject);
</span><span class="c1">//        if(!captureContext) return ;
</span><span class="c1">//    captureObjectId = captureContext-&gt;nameForObject(captureObject);
</span><span class="c1">//    if(captureObjectId.contains(&#34;listview&#34;)) { captureObjectId.append(&#34;_&#34; + captureThings_[&#34;index&#34;].toString()); }
</span><span class="c1"></span>
    <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM_qAP: obj id&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureObjectId</span> <span class="o">&lt;&lt;</span> \
                             <span class="s">&#34;- info:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">key_info</span><span class="p">).</span><span class="n">toString</span><span class="p">()</span>
                             <span class="o">&lt;&lt;</span> <span class="s">&#34;, index:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">key_index</span><span class="p">).</span><span class="n">toString</span><span class="p">()</span>                <span class="c1">// for widget in listview
</span><span class="c1"></span>                             <span class="o">&lt;&lt;</span> <span class="s">&#34;, checked:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">key_checked</span><span class="p">).</span><span class="n">toString</span><span class="p">()</span>            <span class="c1">// for switch or checkBox
</span><span class="c1"></span>                             <span class="o">&lt;&lt;</span> <span class="s">&#34;, currentIndex:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">key_currentIndex</span><span class="p">).</span><span class="n">toString</span><span class="p">()</span>  <span class="c1">// for choose
</span><span class="c1"></span>                             <span class="o">&lt;&lt;</span> <span class="s">&#34;, argExtra:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">key_argExtra</span><span class="p">).</span><span class="n">toString</span><span class="p">()</span>
                             <span class="o">&lt;&lt;</span> <span class="s">&#34;, dialog_btn:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">key_dialog_btn</span><span class="p">).</span><span class="n">toString</span><span class="p">()</span>
                             <span class="o">&lt;&lt;</span> <span class="s">&#34;, dialog_text:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">key_dialog_text</span><span class="p">).</span><span class="n">toString</span><span class="p">()</span>
                             <span class="o">&lt;&lt;</span> <span class="s">&#34;, lang:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">captureThings_</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">key_lang</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>

    <span class="n">captureThings_</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key_id</span><span class="p">);</span>
    <span class="n">sendTrackMsg</span><span class="p">(</span><span class="n">mainPageIndex</span><span class="p">,</span> <span class="n">mainPageSubPageIndex</span><span class="p">[</span><span class="n">mainPageIndex</span><span class="p">],</span> <span class="n">captureObjectId</span><span class="p">,</span> <span class="n">captureThings_</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* track and ID definition shall be clear in a doc somewhere
</span><span class="cm">    sendTrackMsg() will send json msg to &#34;userdata/log/tracker/track_log.xx&#34;
</span><span class="cm">    the process &#34;tracker&#34; in AP will periodically(6h) send its to cloud to visualization data
</span><span class="cm">    immediately trigger &#34;tracker&#34; to send its to cloud cmd: touch /tmp/tracker_debug
</span><span class="cm">*/</span>
<span class="kt">void</span> <span class="n">Track</span><span class="o">::</span><span class="n">sendTrackMsg</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">pageIndex</span><span class="p">,</span> <span class="k">const</span> <span class="n">QString</span><span class="o">&amp;</span> <span class="n">objectID</span><span class="p">,</span> <span class="k">const</span> <span class="n">QVariantMap</span><span class="o">&amp;</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">elapsedTimer</span><span class="p">.</span><span class="n">restart</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">isPrintMsg_</span><span class="p">)</span> <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; --- eM: sendTrackMsg() - page&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">pageIndex</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- ID&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">objectID</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;- arg&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">arg</span><span class="p">;</span>
    <span class="n">QVariantMap</span> <span class="n">trackMsgContent</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="s">&#34;State&#34;</span><span class="p">,</span> <span class="n">XXX</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">()},</span>
        <span class="p">{</span><span class="s">&#34;PageIndex&#34;</span><span class="p">,</span> <span class="n">pageIndex</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;objectID&#34;</span><span class="p">,</span> <span class="n">objectID</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;args&#34;</span><span class="p">,</span> <span class="n">arg</span><span class="p">}</span>
    <span class="p">};</span>
    <span class="n">XXX</span><span class="p">.</span><span class="n">sendTrackerMsg</span><span class="p">(</span><span class="s">&#34;XXX_Track&#34;</span><span class="p">,</span> <span class="n">trackMsgContent</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>qt 新版本 5.15 以上的方法，用到两个类 <a href="https://blog.csdn.net/baidu_41388533/article/details/117091443">https://blog.csdn.net/baidu_41388533/article/details/117091443</a>，这个挺好~</p>
<p>​	一个类 info 存储信息，一个类 person 对外提供调用（实现 <code>qmlAttachedProperties()</code> 里面 返回 new info 类，用 <code>QML_ATTACHED(Info)</code> 让 person 类 可以访问 info 类成员），main.c 在 load qml 之前 注册 <code>qmlRegisterUncreatableType&lt;Person&gt;()</code>，qml 里面 运行到 该附加属性的时候，先调 <code>qmlAttachedProperties()</code>，即 new info 类，即 qml 里面 每一个控件 对应一个 info 类，用 Person 附加属性 调 info 的成员 进行读写，如 <code>Person.name: ...</code> 或 <code>Person.name = ...</code>。</p>
<h4 id="ui-埋点">UI 埋点</h4>
<p>加埋点，用户行为统计。下面是笼统的概念介绍</p>
<ul>
<li>
<p><a href="https://blog.csdn.net/weixin_39614276/article/details/111437770">https://blog.csdn.net/weixin_39614276/article/details/111437770</a></p>
</li>
<li>
<p><a href="https://www.xiaohongshu.com/explore/63bbe67c000000002203688c">https://www.xiaohongshu.com/explore/63bbe67c000000002203688c</a></p>
<blockquote>
<p>认识B端｜前端需求埋点</p>
<p>👉埋点流程👈</p>
<p>01选择埋点类型</p>
<p>一般分为页面埋点、模块埋点、组件埋点、其他类型埋点</p>
<p>02编辑埋点信息</p>
<p>填写需求名称、prd链接、需求描述、预计上线版本等信息</p>
<p>03需求提审</p>
<p>埋点需求制作完成后，点击提交审核，生成审批工单给数仓审核</p>
<p>04需求开发</p>
<p>需求审核通过后，可以分享需求链接给开发同学进行开发</p>
<p>05需求验证</p>
<p>对埋点需求进行验证，验证埋点需求的正确性</p>
<p>06需求上线</p>
<p>需求开发完成并且验证没有问题后，点击需求上线，就可以开始分析数据了</p>
<p>🚗前端埋点类型:</p>
<p>1.页面埋点:发生在页面上，在页面加载完成后触发或在页面退出时触发的埋点事件。</p>
<p>2.模块埋点:发生在单个页面的某个模块上点击和曝光的埋点事件，例如:按钮、图片、弹窗、浮层等。</p>
<p>3.组件埋点:发生在某个模块上且该模块被多个系统页面重复使用，营销大转盘。</p>
<p>4.其他埋点:发生在更多其他类型事件模版，例如:视频播放结束事件、扫码事件、蓝牙事件等。</p>
<p>🚕变量命名规范</p>
<p>1)统一遵循小驼峰的命名规范:除第一 个单词之外，其他单词首字母大写;</p>
<p>2)统一格式为{业务}_ {组件|页面}_ {具体元素}， 比如finance_ .qualityHomePage_ repay;</p>
<p>🚙触发时机说明</p>
<p>1)浏览/pageview:采集用户浏览页面相关的数据，用户打开该页面即会被记录一次;</p>
<p>2)点击/click: 采集用户的点击行为相关的数据，用户点击页面上某个按钮会被记录一次;</p>
<p>3)曝光/expose:采集某个页面/模块被看到的数据，用户有效浏览页面/模块会被记录一次;</p>
</blockquote>
</li>
<li>
<p>3种前端埋点方式 <a href="https://blog.csdn.net/LuckyWinty/article/details/130939489">https://blog.csdn.net/LuckyWinty/article/details/130939489</a></p>
<blockquote>
<p>最直接有效的方式就是了解用户的行为，了解用户在网站中做了什么，呆了多久。</p>
<p><code>所谓'埋点'是数据采集领域（尤其是用户行为数据采集领域）的术语，指的是针对特定用户行为或事件进行捕获、处理和发送的相关技术及其实施过程。. 比如用户某个icon点击次数、观看某个视频的时长等等</code>。</p>
<p>基于此我们可以知道埋点是实际上是对特定事件或者行为的数据监控和上报。</p>
</blockquote>
</li>
<li>
<p>前端数据打点（埋点） <a href="https://blog.csdn.net/m0_70190404/article/details/128477172">https://blog.csdn.net/m0_70190404/article/details/128477172</a></p>
</li>
<li>
<p>前端埋点实现方案 <a href="https://huaweicloud.csdn.net/639fe937dacf622b8df8faa8.html">https://huaweicloud.csdn.net/639fe937dacf622b8df8faa8.html</a></p>
<blockquote>
<p>埋点就是在应用中特定的流程收集一些信息，用来跟踪应用使用的状况，后续用来进一步优化产品或是提供运营的数据支撑，包括访问数（Visits），访客数（Visitor），停留时长（Time On Site），页面浏览数（Page Views）和跳出率（Bounce Rate）。这样的信息收集可以大致分为两种：页面统计（track this virtual page view），统计操作行为（track this button by an event）。</p>
<p>两方面上报: 1.事件上报(目前只有点击事件埋点)，2.停留时间上报</p>
<ul>
<li><strong>事件上报</strong>：通过给元素绑定自定义指令的方式实现(减少对原有代码的侵入)🍜，将信息<a href="https://activity.huaweicloud.com/free_test/index.html?utm_source=hwc-csdn&amp;utm_medium=share-op&amp;utm_campaign=&amp;utm_content=&amp;utm_term=&amp;utm_adplace=AdPlace070851" target="_blank" rel="noopener noreffer">存储</a>在缓存池中定时上报，上报之后清空之前的上报信息🥠。</li>
<li><strong>停留时间上报</strong>：需要重新封装路由，创建路由拦截在跳转之前记录来源,以及上一个页面的停留时间，当拦截器捕获成功之后🌯，如果发现停留时间大于xx秒进行上报🥙。</li>
</ul>
</blockquote>
</li>
</ul>
<p>原始 背景 和 需求：</p>
<ol>
<li>用户行为统计，收集用户习惯，比如点击顺序或者点击热点。</li>
<li>目前设计比较复杂，找出用户不常用的，看是不是设计有问题。</li>
<li>打埋点的地方，同时也输出到调试日志。</li>
</ol>
<p>下面是细化：</p>
<p>埋点类型，可以用 event 区分下面这些 类型事件 的发生：</p>
<ul>
<li>
<p>页面切换（当前页面的字符串变量发生变化时记录，确保跟UI显示的一致）。</p>
<ul>
<li>记录当前所在页面，记录切换到了哪个页面。</li>
</ul>
</li>
<li>
<p>点击按键（点击时记录）。</p>
</li>
<li>
<p>点击选择框 和 开关（点击后记录点击后控件的开关状态）。</p>
</li>
<li>
<p>选择下拉框（点击下拉框 + 选择的项，点击后记录）。</p>
</li>
<li>
<p>合并按键，一个区域的所有按键任何一个点击当作同一个。</p>
<ul>
<li>给这些在一个区域的控件再添加新的 subName 都保持一样，这样能筛选出来。</li>
</ul>
</li>
<li>
<p>弹窗中的按键（比如点击格式化后的弹窗）。</p>
<ul>
<li>记录当前点击的弹窗中的按键或其它类型控件。</li>
<li>每个弹窗有个 独一无二 的 id，当作区分弹窗。</li>
</ul>
</li>
<li>
<p>操作链（10秒间隔 或 50次操作间隔），前两种，量大了会看出趋势。</p>
</li>
<li>
<p>具体的一些关键操作统计，包含一些列特定的操作，或者完整的打开和关闭了某一个设置页面（包括停留时间），编程需要根据一些列特定事件才算计数加一。</p>
</li>
<li>
<p>语言切换（切换事件时记录）。</p>
</li>
<li>
<p>页面停留时间。</p>
<ul>
<li>一级页面 和 二级页面 切换之间的停留时间。</li>
<li>各种弹出子页面，即特定的按键和返回按键（两个按键 id 做成一对，方便识别），两个点击事件之间的时间，可由处理埋点信息端计算。</li>
</ul>
</li>
<li>
<p>开机事件。</p>
</li>
<li>
<p>开始升级，结束升级。</p>
</li>
<li>
<p>qml 控件中其它信息，可以任指定。</p>
</li>
</ul>
<p>需要上报的信息：</p>
<p>在 C++ 端写统一调用的函数，并设计一个是否埋的开关。打埋点的地方，同时也输出到调试日志。</p>
<p>埋点的控件，发生点击等事件后，上报的信息：</p>
<p>json 例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&#34;evt&#34;</span><span class="p">:</span><span class="s2">&#34;jMachine_UITrack&#34;</span><span class="p">,</span>
    <span class="nt">&#34;content&#34;</span><span class="p">:{</span>
        <span class="nt">&#34;event&#34;</span><span class="p">:</span><span class="err">&lt;</span><span class="s2">&#34;pageBtn&#34;</span><span class="p">,</span><span class="nt">&#34;btn&#34;</span><span class="p">,</span><span class="nt">&#34;checkBox&#34;</span><span class="p">,</span><span class="nt">&#34;switchBtn&#34;</span><span class="p">,</span><span class="nt">&#34;choise&#34;</span><span class="p">,</span><span class="nt">&#34;dialogBtn&#34;</span><span class="p">,</span><span class="nt">&#34;operationChain&#34;</span><span class="err">&gt;</span><span class="p">,</span>
        <span class="err">//</span> <span class="err">一级页切换按键、按键、选择框</span> <span class="err">/</span> <span class="err">开关、下拉框、弹窗中的按键、操作链上报事件</span>
        
        <span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="s2">&#34;...&#34;</span><span class="p">,</span>
        
        <span class="nt">&#34;choiseIndex&#34;</span><span class="p">:</span><span class="err">x</span><span class="p">,</span>      <span class="err">//</span> <span class="err">对于</span> <span class="err">event</span> <span class="err">为</span> <span class="err">choise</span> <span class="err">时候才有，选择了第几项</span>
        <span class="nt">&#34;checked&#34;</span><span class="p">:</span><span class="kc">true</span><span class="err">/</span><span class="kc">false</span><span class="p">,</span> <span class="err">//</span> <span class="err">对于</span> <span class="err">event</span> <span class="err">为</span> <span class="err">checkBox</span> <span class="err">或</span> <span class="err">switchBtn</span> <span class="err">时候才有，开了还是关了</span>
        
        <span class="nt">&#34;dialogType&#34;</span><span class="p">:</span><span class="s2">&#34;xxx&#34;</span><span class="err">，</span>  <span class="err">//</span> <span class="err">对于</span> <span class="err">event</span> <span class="err">为</span> <span class="err">dialogBtn</span> <span class="err">时候才有，这个弹窗的类型，错误、警告、提示</span> <span class="err">等</span>
        <span class="s2">&#34;dialogId&#34;</span><span class="p">:</span><span class="s2">&#34;xxx&#34;</span><span class="p">,</span>     <span class="err">//</span> <span class="err">对于</span> <span class="err">event</span> <span class="err">为</span> <span class="err">dialogBtn</span> <span class="err">时候才有，这个弹窗的唯一</span> <span class="err">id，文案唯一对应的</span> <span class="err">编号</span> <span class="err">或缩减字符串</span>
        
        <span class="nt">&#34;extraInfo&#34;</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span>    <span class="err">//自定</span>
         
        <span class="nt">&#34;pageName&#34;</span><span class="p">:</span><span class="s2">&#34;xxx&#34;</span><span class="p">,</span>     <span class="err">//</span> <span class="err">发生事件时候所在页面</span>
        <span class="nt">&#34;State&#34;</span><span class="p">:</span><span class="err">x</span><span class="p">,</span>       <span class="err">//</span> <span class="err">机器单当前所在阶段，状态机所在状态</span> <span class="err">空闲、工作中、暂停等。</span>
 
        <span class="nt">&#34;lang&#34;</span><span class="p">:</span><span class="s2">&#34;en/zh-cn/de/...&#34;</span><span class="p">,</span>
        <span class="nt">&#34;sn&#34;</span><span class="p">:</span><span class="err">xxx</span><span class="p">,</span>             <span class="err">//</span> <span class="err">机器唯一序列号</span>
        <span class="nt">&#34;time&#34;</span><span class="p">:</span><span class="err">xxx</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="err">//</span> <span class="err">还有记录一整个状态变化之中，所发生事件的计数</span>
<span class="err">//</span> <span class="err">比如：开始工作</span> <span class="err">→</span> <span class="err">成功完成工作：start</span> <span class="err">(state</span> <span class="err">从</span> <span class="mi">1</span> <span class="err">到</span> <span class="mi">2</span><span class="err">)</span> <span class="err">→</span> <span class="err">complete</span> <span class="err">(state</span> <span class="err">从</span> <span class="mi">2</span> <span class="err">到</span> <span class="mi">1</span><span class="err">)</span>
<span class="s2">&#34;control&#34;</span><span class="err">:</span><span class="s2">&#34;wholeEvent&#34;</span><span class="err">,</span><span class="s2">&#34;beginStage:1,&#34;</span><span class="err">endStage</span><span class="s2">&#34;:2,&#34;</span><span class="err">id</span><span class="s2">&#34;:&#34;</span><span class="err">skipBtn</span><span class="s2">&#34;,&#34;</span><span class="err">times&#34;:</span><span class="mi">0</span><span class="err">,...</span>
</code></pre></td></tr></table>
</div>
</div><p>要埋点的控件 id 命名规范：</p>
<ul>
<li>id 命名 有一定的 可辨识的含义。</li>
<li>没有特别限制，保证在一个 UI 页面里面的所有控件 id 不重复即可。</li>
<li>类型 控件，推荐尽量在 id 加个类型尾缀，比如有 xxxRect，xxxBtn，xxxImage，xxxText，xxxListView，xxxModel，xxxDeleComp 等。</li>
</ul>
<p>方案：</p>
<p><strong>第一种：eventMonitor。为了便于埋点，减少侵入 qml 代码，给特定的控件添加埋点功能，按照 一定的 控件 id 命名规范，区分开控件即可</strong></p>
<p>参考 <code>QT 事件传播链 / 加事件过滤</code></p>
<p>但是存在的问题分析，见里面。</p>
<p><a href="https://www.xjishu.com/zhuanli/55/202110265850.html">https://www.xjishu.com/zhuanli/55/202110265850.html</a></p>
<p><a href="https://cprs.patentstar.com.cn/Search/Detail?ANE=9FHF1ABA8CEA9HHG4DAA8FDA7AFA9BCA9HCFEGHA9AFB9HFD">https://cprs.patentstar.com.cn/Search/Detail?ANE=9FHF1ABA8CEA9HHG4DAA8FDA7AFA9BCA9HCFEGHA9AFB9HFD</a></p>
<p><strong>第二种：qmlAttachedProperties。在 qml 文件头 引用库 “import Track 1.0” 之后在要埋点的控件的 响应槽函数里面添加 “Tk.c = {&ldquo;id&rdquo;: xxx} ” 即表示上报 这个控件的 xxx 属性</strong></p>
<p>UI 工程的 界面控件一般都是使用 自己封装 qml 原生控件 的 定制基础控件，在定制基础控件里面埋点，再向上找所有 parent 来找界面控件的 id 和所在页面，合成 id，也可以不合成，上报信息的时候信息全一些就行。</p>
<p>附加属性机制对于有定制基础控件的 qt 工程方便实施，但有个缺陷，就是qml中按键执行 onclicked() 和 后端 执行收集信息 可能是并发进行的，若采集信息里面包含 onclicked() 里面设置的变量，那么前后行为不确定，这个可以通过在 里面 onclicked() 合适的位置 直接给附加属性赋值来解决，这又变成挨个加，分散到业务代码里；而 eventFilter 不会有这样问题，一个事件会先进入 eventFilter() 函数再 执行 按键的 onclicked()，前后行为确定。</p>
<p>其它方法，但不实际用。</p>
<ul>
<li>
<p>法3：（挨个添加）官方工具 Qt Insight 等，可以轻松实现埋点和跟踪，首先需要钱，其次上传的云端也是 qt 指定的平台 <a href="https://insight.qt.io">https://insight.qt.io</a>。</p>
<p><a href="https://www.qt.io/product/insight/onboarding-instructions">https://www.qt.io/product/insight/onboarding-instructions</a></p>
<p>Qt Insight 的使用 需要 Qt 企业账户（若 app 商用也许会被检测到）。</p>
<p>Qt 官方规定使用 Qt Insight 上传用户数据，需要在 app 界面上 加一个关闭开关。https://www.qt.io/terms-conditions/terms-of-use-qt-insight-tracker-library</p>
<p>Qt Insight 作为库使用：</p>
<blockquote>
<h5 id="availability"><strong>Availability</strong></h5>
<p><strong>Qt 6.5-beta3 (available now)</strong></p>
<p>Qt Insight Tracker library can be installed with <a href="https://account.qt.io/s/downloads" target="_blank" rel="noopener noreffer">Qt Installer</a> by selecting Custom Installation -&gt; Qt -&gt; Qt 6.5.0-beta3 -&gt; Additional Libraries -&gt; Qt Insight Tracker</p>
<p><strong>Qt 6.2.8 (coming in March 2023)</strong></p>
<p><strong>Qt 5.15.14 (coming in May 2023)</strong></p>
</blockquote>
<p>Qt Insight 在 Qt Design Studio 里面可以直接 作为组件 用起来。</p>
<p>在 qt creater 里面，在 c++ 类 或 qml 来使用 qt insight ，需要单独给每个 按键 / 鼠标区域 添加 <code>InsightTracker.sendClickEvent()</code>，仍然不是统一加的方法。</p>
</li>
</ul>
<h4 id="qt显示中文问题">Qt显示中文问题</h4>
<p>根上讲编码 <a href="https://blog.csdn.net/m0_46577050/article/details/133804929">https://blog.csdn.net/m0_46577050/article/details/133804929</a></p>
<p>直接的方法 <a href="https://blog.csdn.net/yiyiyayade_niu/article/details/129393525">https://blog.csdn.net/yiyiyayade_niu/article/details/129393525</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// 1 std::string 转 QString
</span><span class="c1"></span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&#34;乱码&#34;</span><span class="p">;</span>
<span class="n">QString</span> <span class="n">qs</span><span class="o">=</span><span class="n">QString</span><span class="o">::</span><span class="n">fromLocal8Bit</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

<span class="c1">// 2 QString 转 std::string
</span><span class="c1"></span>
<span class="n">QString</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&#34;乱码&#34;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">toLocal8Bit</span><span class="p">());</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="具体控件积累">具体控件积累</h2>
<p><em>p.s 下面会贴一些关键代码。</em></p>
<p><em>p.ss 所遇问题日常添加在此，且顺序无关，按需去看即可</em></p>
<h3 id="qt-实用类-集合">QT 实用类 集合</h3>
<h4 id="qflags">QFlags</h4>
<p>对 enmu 例化一个变量，用 setFlag()、testFlag() 等 增减 enmu 项，还有其它 操作符重载，是一个安全、好用的工具。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">enum</span> <span class="nc">Flag</span> <span class="p">{</span>
    <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">};</span>

<span class="n">Q_DECLARE_FLAGS</span><span class="p">(</span><span class="n">Flags</span><span class="p">,</span> <span class="n">Flag</span><span class="p">)</span>
<span class="n">Q_FLAG</span><span class="p">(</span><span class="n">Flags</span><span class="p">)</span> <span class="c1">// for Qt Script or edited in Qt Designer
</span><span class="c1"></span>
<span class="n">Flags</span> <span class="n">flag_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>

<span class="n">flag_</span><span class="p">.</span><span class="n">testFlag</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
<span class="n">flag_</span><span class="p">.</span><span class="n">setFlag</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nb">true</span> <span class="o">/</span> <span class="nb">false</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="qelapsedtimer">QElapsedTimer</h4>
<p>好用，比如 <code>if(elapsedTimer.restart() &lt; 50) return ; // max 20hz operate</code>。</p>
<h4 id="qasconst">qAsConst</h4>
<p>要处理某个信息时候，防止篡改</p>
<h4 id="qsharedpointer">QSharedPointer</h4>
<h4 id="qcache">QCache</h4>
<h3 id="qdebug-重定向">qDebug() 重定向</h3>
<p><a href="https://cloud.tencent.com/developer/article/1930475">https://cloud.tencent.com/developer/article/1930475</a></p>
<p>通过 qInstallMessageHandler() 设置重定向数据的去向</p>
<h3 id="获取自身-内存占用-和-cpu-使用率">获取自身 内存占用 和 CPU 使用率</h3>
<p><a href="https://www.5axxw.com/questions/simple/tfvpez">https://www.5axxw.com/questions/simple/tfvpez</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// 内存占用获取
</span><span class="c1">// 这个写的并不优雅， 直接用 pmap 命令的返回信息（如下） 比较大 而且是 RSS，需要的是 PSS 或者 USS。
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;QProcess&gt;</span><span class="cp">
</span><span class="cp"></span><span class="n">qint64</span> <span class="n">processId</span> <span class="o">=</span> <span class="n">QCoreApplication</span><span class="o">::</span><span class="n">applicationPid</span><span class="p">();</span> <span class="c1">//获取当前进程的PID
</span><span class="c1"></span><span class="n">QStringList</span> <span class="n">arguments</span><span class="p">;</span>
<span class="n">arguments</span> <span class="o">&lt;&lt;</span> <span class="n">QString</span><span class="o">::</span><span class="n">number</span><span class="p">(</span><span class="n">processId</span><span class="p">);</span>
<span class="c1">//执行命令&#34;pmap -x &lt;processId&gt;&#34;，获取当前进程的内存映射
</span><span class="c1"></span><span class="n">QProcess</span> <span class="n">p</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="s">&#34;pmap&#34;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">waitForFinished</span><span class="p">();</span> <span class="c1">//等待命令结束
</span><span class="c1"></span><span class="n">QString</span> <span class="n">result</span> <span class="o">=</span> <span class="n">QString</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readAllStandardOutput</span><span class="p">());</span>
<span class="n">QStringList</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
<span class="n">qint64</span> <span class="n">memoryUsage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="n">QString</span> <span class="nl">line</span> <span class="p">:</span> <span class="n">lines</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">QStringList</span> <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">SkipEmptyParts</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">qint64</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">toLongLong</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="n">memoryUsage</span> <span class="o">+=</span> <span class="n">size</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Memory usage:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">memoryUsage</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;KB&#34;</span><span class="p">;</span>

<span class="c1">// CPU 使用率
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;QThread&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="n">cpuUsage</span> <span class="o">=</span> <span class="n">qBound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">qRound</span><span class="p">(</span><span class="n">QThread</span><span class="o">::</span><span class="n">currentThread</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">cpuUsage</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">100</span><span class="p">);</span>
<span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;CPU usage:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">cpuUsage</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;%&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="添加-icon-图标">添加 icon 图标</h3>
<p>给可执行文件 添加 icon 图标</p>
<p>​	https://www.cnblogs.com/maijin/p/17264089.html</p>
<h3 id="mousearea--taphandler">MouseArea / TapHandler</h3>
<p>MouseArea</p>
<p>​	https://waleon.blog.csdn.net/article/details/129252688</p>
<p>​	https://blog.csdn.net/kingzhou_/article/details/128193953 QML事件处理之鼠标事件（MouseEvent）和滚轮事件（WheelEvent）</p>
<p>TapHandler</p>
<p><a href="https://blog.csdn.net/u011942101/article/details/122433972">https://blog.csdn.net/u011942101/article/details/122433972</a></p>
<blockquote>
<p>TapHandler有效敲击手势的检测取决于gesturePolicy。默认值为DraggThreshold,它要求按下和释放键在空间和时间上都紧密靠近。</p>
</blockquote>
<h3 id="动态-创建--加载组件">动态 创建 / 加载组件</h3>
<p>QML 中如何动态创建组件：<strong>ViewList</strong>，<strong>Loader</strong>，createObject / createQmlObject
<a href="https://blog.csdn.net/m0_73443478/article/details/129844157">https://blog.csdn.net/m0_73443478/article/details/129844157</a></p>
<blockquote>
<p>当Loader的source或sourceComponent属性发生变化时，它之前加载的Component会自动销毁，新对象会被加载。</p>
<p>Loader的item属性指向它加载的组件的顶层Item。对于Loader加载的Item，它暴露出来的接口，如属性、信号等，都可以通过Loader的item属性来访问。</p>
</blockquote>
<p>Loader 有一个 Loaded 信号，可以用。</p>
<p>Component 一般用于新定义一个组件，单个文件的（需要id与文件名一致，且文件名首字母大写）或者定义在一个文件里面，其下就一个 id 属性 和 item{ &hellip; }。</p>
<blockquote>
<p>如果Loader加载的Item想处理按键事件，那么必须将Loader对象的focus属性设置为true（注，不是必须，根据自己工程情况多调试试试）。又因为Loader本身也是一个焦点敏感的对象，所以如果它加载的Item处理了按键事件，则应当将事件的accepted属性设置为true，以免已经被吃掉的事件再传递给Loader。</p>
</blockquote>
<h3 id="listmodel--listview">ListModel &amp; ListView</h3>
<p>​	https://blog.csdn.net/u011942101/article/details/115050458</p>
<p>若 ListView 数据来自 c++ 后端，则在 其 delegate 的 Component 里面引用 Model 数据应该用 <code>modelData.xxx</code>。</p>
<p>在 delegate 里面 可以使用 附加属性的一些信息 <code>delegate的component的item.ListView.view</code> 等等，看手册即可</p>
<p>Qml ListView 的 组件里面包含 下拉框 ComboBox，将下拉框内的文本也放入 ListModel 里面
<a href="https://qa.1r1g.com/sf/ask/3160982681/">https://qa.1r1g.com/sf/ask/3160982681/</a></p>
<p>Qml ListView 动画
<a href="https://gongjianbo1992.blog.csdn.net/article/details/109713124">https://gongjianbo1992.blog.csdn.net/article/details/109713124</a>
<a href="https://blog.csdn.net/m0_60259116/article/details/129336808">https://blog.csdn.net/m0_60259116/article/details/129336808</a></p>
<p>Repeater
<a href="https://blog.csdn.net/qq_26611129/article/details/113933202">https://blog.csdn.net/qq_26611129/article/details/113933202</a>
<a href="https://blog.csdn.net/aoiyoru/article/details/128202698">https://blog.csdn.net/aoiyoru/article/details/128202698</a>
<a href="https://www.python100.com/html/89698.html">https://www.python100.com/html/89698.html</a>
使用Repeater时的注意事项：总的评价：不如 ListView
Repeater在第一次创建时会创建其所有委托项。如果存在大量的委托项，并且不是所有的项都需要同时可见，那么这么做效率可能会很低。如果是这种情况，请考虑使用其他视图类型，如ListView（它仅在将委托项滚动到视图中时创建委托项），或者根据需要使用动态对象创建方法来创建委托项。</p>
<h3 id="信息打印">信息打印</h3>
<p>QML 打印信息：</p>
<p>​	https://blog.csdn.net/kenfan1647/article/details/122013713</p>
<p>c/c++ 端 定义，QML 端调用：</p>
<p>不用多色，就 [info]、[warn]..</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">void</span> <span class="n">XXX</span><span class="o">::</span><span class="n">log_msg</span><span class="p">(</span><span class="n">QString</span> <span class="n">id</span><span class="p">,</span> <span class="n">QString</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;msg&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">id</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 多色打印可以参考 https://zhuanlan.zhihu.com/p/331847712
</span><span class="c1">// 但是 不是所有 cmd 都支持显示彩色 log 的，如果不支持从而显示原生字符则会显得很乱
</span><span class="c1"></span><span class="kt">void</span> <span class="n">XXX</span><span class="o">::</span><span class="n">log_info</span><span class="p">(</span><span class="n">QString</span> <span class="n">id</span><span class="p">,</span> <span class="n">QString</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">qInfo</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[0;&#34;</span> <span class="s">&#34;34&#34;</span> <span class="s">&#34;;m&#34;</span> <span class="s">&#34;- info&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">id</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[0m&#34;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">XXX</span><span class="o">::</span><span class="n">log_warn</span><span class="p">(</span><span class="n">QString</span> <span class="n">id</span><span class="p">,</span> <span class="n">QString</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">qInfo</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[0;&#34;</span> <span class="s">&#34;33&#34;</span> <span class="s">&#34;;m&#34;</span> <span class="s">&#34;- info&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">id</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[0m&#34;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">XXX</span><span class="o">::</span><span class="n">log_crit</span><span class="p">(</span><span class="n">QString</span> <span class="n">id</span><span class="p">,</span> <span class="n">QString</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">qWarning</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[0;&#34;</span> <span class="s">&#34;1&#34;</span> <span class="s">&#34;;&#34;</span> <span class="s">&#34;31&#34;</span> <span class="s">&#34;;m&#34;</span> <span class="s">&#34;- info&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">id</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[0m&#34;</span><span class="p">;</span>

<span class="p">}</span>

<span class="cm">/*
</span><span class="cm">    qml usage：
</span><span class="cm">    property var lm: XXX.log_msg
</span><span class="cm">    property var li: XXX.log_info
</span><span class="cm">    property var lw: XXX.log_warn
</span><span class="cm">    property var lc: XXX.log_crit
</span><span class="cm">
</span><span class="cm">    // fill &#34;c++ function or qml object id&#34;(when use in c file) and msg
</span><span class="cm">    lm(&#34;&lt;c++ function or qml object id&gt;&#34;, &#34;msg...&#34;)
</span><span class="cm">    li(&#34;fun 1&#34;, &#34;msg...&#34;)
</span><span class="cm">    lw(&#34;qml obj&#34;, &#34;msg...&#34;)
</span><span class="cm">    lc(&#34;id 3&#34;, &#34;msg...&#34;)
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="模拟点击--随即点击">模拟点击 / 随即点击</h3>
<p>问 chatGPT 给的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;QCoreApplication&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QMouseEvent&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QApplication&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QWidget&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QRandomGenerator&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QTimer&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">simulateClick</span><span class="p">(</span><span class="n">QWidget</span><span class="o">*</span> <span class="n">widget</span><span class="p">,</span> <span class="k">const</span> <span class="n">QPoint</span><span class="o">&amp;</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QMouseEvent</span> <span class="n">pressEvent</span><span class="p">(</span><span class="n">QEvent</span><span class="o">::</span><span class="n">MouseButtonPress</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">LeftButton</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">LeftButton</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">NoModifier</span><span class="p">);</span>
    <span class="n">QApplication</span><span class="o">::</span><span class="n">postEvent</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pressEvent</span><span class="p">);</span>

    <span class="n">QMouseEvent</span> <span class="n">releaseEvent</span><span class="p">(</span><span class="n">QEvent</span><span class="o">::</span><span class="n">MouseButtonRelease</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">LeftButton</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">LeftButton</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">NoModifier</span><span class="p">);</span>
    <span class="n">QApplication</span><span class="o">::</span><span class="n">postEvent</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">releaseEvent</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">performMonkeyTest</span><span class="p">(</span><span class="n">QWidget</span><span class="o">*</span> <span class="n">widget</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QTimer</span><span class="o">*</span> <span class="n">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QTimer</span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
    <span class="n">QObject</span><span class="o">::</span><span class="n">connect</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">QTimer</span><span class="o">::</span><span class="n">timeout</span><span class="p">,</span> <span class="p">[</span><span class="n">widget</span><span class="p">]()</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">QRandomGenerator</span><span class="o">::</span><span class="n">global</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">bounded</span><span class="p">(</span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">());</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">QRandomGenerator</span><span class="o">::</span><span class="n">global</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">bounded</span><span class="p">(</span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">());</span>
        <span class="n">simulateClick</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="c1">// 设置定时器间隔，单位是毫秒
</span><span class="c1"></span>    <span class="n">timer</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 每秒模拟一次点击
</span><span class="c1"></span><span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">QCoreApplication</span> <span class="n">a</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

    <span class="c1">// 创建一个窗口
</span><span class="c1"></span>    <span class="n">QWidget</span> <span class="n">widget</span><span class="p">;</span>
    <span class="n">widget</span><span class="p">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
    <span class="n">widget</span><span class="p">.</span><span class="n">show</span><span class="p">();</span>

    <span class="c1">// 执行 Monkey 测试
</span><span class="c1"></span>    <span class="n">performMonkeyTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">widget</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="多页面切换">多页面切换</h3>
<p><a href="https://blog.csdn.net/weixin_34290631/article/details/86364900">https://blog.csdn.net/weixin_34290631/article/details/86364900</a></p>
<p>就推荐用两种：</p>
<ol>
<li>Component 组件的 <code>object createObject(QtObject parent, object properties)</code> 方法。</li>
<li>Loader，设置 <code>.source = xxx.qml</code> 或者 <code>.sourceComponent  = xxx</code> 创建，设置 <code>.source = “”</code> 销毁。</li>
</ol>
<p>其它：StackView、SwipeView，是特定场景用：</p>
<ul>
<li>
<p>StackView 可以用于 进入多个 一连串的 子页面（push()），而且还要逐一返回（pop()），可以进入一个临时的设置或展示用的子页面，然后按键返回退出（才能释放）</p>
</li>
<li>
<p>SwipeView 相当于 一系列 引导页面，逐个过，这种场合。</p>
</li>
</ul>
<h3 id="qt-多线程">QT 多线程</h3>
<blockquote>
<p>QThread有两种用法：</p>
<p>1、（推荐）写一个QObject子类A，实例化之，再实例化一个 Qthread 类 的 示例 AQthread，A.moveToThread(&amp;AQthread)，然后运行线程，AQthread.start()，调用 类A 里的函数即在 Qthread 线程里运行。</p>
<p>2、子类化一个QThread，然后实现run()虚函数</p>
<p>然后使用 thread-&gt;start(); 来启动 线程</p>
</blockquote>
<p><a href="https://blog.csdn.net/zz_6_3/article/details/109399098">https://blog.csdn.net/zz_6_3/article/details/109399098</a></p>
<p><a href="https://blog.csdn.net/qq_40041064/article/details/114921026">https://blog.csdn.net/qq_40041064/article/details/114921026</a></p>
<p>QThread 相关 API</p>
<p><a href="https://betheme.net/dashuju/23242.html?action=onClick">https://betheme.net/dashuju/23242.html?action=onClick</a></p>
<p>法1 的例子，可以看 正点原子的 QT 教程 手册，第十章 多线程。</p>
<p>法2 的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// simpleQThread.h
</span><span class="c1"></span>
<span class="cp">#ifndef WORKERQTHREAD_H
</span><span class="cp">#define WORKERQTHREAD_H
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QObject&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QThread&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QDebug&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">class</span> <span class="nc">simpleQThread</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QThread</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">simpleQThread</span><span class="p">();</span>
    <span class="n">simpleQThread</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">()</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">action</span><span class="p">);</span>
<span class="c1">//    ~workerQThread();
</span><span class="c1"></span>
    <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">postRunFn</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">()</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">action</span><span class="p">);</span>

<span class="nl">signals</span><span class="p">:</span>

<span class="k">public</span> <span class="nl">slots</span><span class="p">:</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">()</span><span class="o">&gt;*</span> <span class="n">action_</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="c1">// WORKERQTHREAD_H
</span><span class="c1"></span>

<span class="c1">// simpleQThread.cpp
</span><span class="c1"></span>
<span class="cp">#include</span> <span class="cpf">&#34;simpleqthread.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="n">simpleQThread</span><span class="o">::</span><span class="n">simpleQThread</span><span class="p">()</span>
    <span class="o">:</span> <span class="n">action_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">simpleQThread</span><span class="o">::</span><span class="n">simpleQThread</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">()</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">action</span><span class="p">)</span>
    <span class="o">:</span> <span class="n">action_</span><span class="p">(</span><span class="o">&amp;</span><span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">simpleQThread</span><span class="o">::</span><span class="n">postRunFn</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">()</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">action_</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">action</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">simpleQThread</span><span class="o">::</span><span class="n">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">(</span><span class="o">*</span><span class="n">action_</span><span class="p">)();</span>
<span class="p">}</span>


<span class="c1">// 使用例子：
</span><span class="c1"></span>
<span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">()</span><span class="o">&gt;</span> <span class="n">abc</span><span class="p">(</span>
    <span class="p">[]()</span> <span class="o">-&gt;</span> <span class="kt">void</span> <span class="p">{</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">QThread</span><span class="o">::</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;---------------------------&#34;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

<span class="n">simpleQThread</span><span class="o">*</span> <span class="n">abcQThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">simpleQThread</span><span class="p">(</span><span class="n">abc</span><span class="p">);</span>
<span class="n">abcQThread</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="延时">延时</h3>
<p>（纯 C++）</p>
<p>这些会阻塞当前线程，如果只有一个线程，那么其它地方将不响应。</p>
<p>​	https://blog.csdn.net/qq_36659059/article/details/118521190</p>
<ul>
<li>
<p>多线程 程序使用<code>QThread::sleep()</code>， <code>QThread::msleep(1000)</code>。</p>
</li>
<li>
<p>使用 <code>QEventLoop</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">void</span> <span class="n">Widget</span><span class="o">::</span><span class="n">Sleep</span><span class="p">(</span><span class="kt">int</span> <span class="n">msec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">QTime</span> <span class="n">dieTime</span> <span class="o">=</span> <span class="n">QTime</span><span class="o">::</span><span class="n">currentTime</span><span class="p">().</span><span class="n">addMSecs</span><span class="p">(</span><span class="n">msec</span><span class="p">);</span>
	<span class="k">while</span><span class="p">(</span> <span class="n">QTime</span><span class="o">::</span><span class="n">currentTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">dieTime</span> <span class="p">){}</span>
	<span class="n">QCoreApplication</span><span class="o">::</span><span class="n">processEvents</span><span class="p">(</span><span class="n">QEventLoop</span><span class="o">::</span><span class="n">AllEvents</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>用 QEventLoop + QTimer::singleShot <a href="https://it.cha138.com/nginx/show-3077466.html">https://it.cha138.com/nginx/show-3077466.html</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">QEventLoop</span> <span class="n">eventloop</span><span class="p">;</span>
<span class="n">QTimer</span><span class="o">::</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">eventloop</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">quit</span><span class="p">()));</span>
<span class="n">eventloop</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="文件读写">文件读写</h3>
<p>（纯 C++）：QFile 类</p>
<p>​	https://blog.csdn.net/QtCompany/article/details/130691341 （API 介绍）</p>
<p>​	https://blog.csdn.net/weixin_44618297/article/details/123538302（API 介绍）</p>
<p>​	https://blog.csdn.net/QtCompany/article/details/131013800 （C++写成类库，qmlRegisterSingletonType，qml调用）</p>
<p>​	https://blog.csdn.net/wangpailiulanqi8/article/details/125926116（C++写成类库，qmlRegisterSingletonType，qml导入再调用）</p>
<h3 id="文件浏览">文件浏览</h3>
<p>c++ 和 qml</p>
<p><a href="https://blog.csdn.net/u011942101/article/details/124220963">https://blog.csdn.net/u011942101/article/details/124220963</a></p>
<p><a href="https://www.cnblogs.com/listensong/p/4202039.html">https://www.cnblogs.com/listensong/p/4202039.html</a></p>
<p>这个用到的数据结构比较多</p>
<p><a href="https://blog.csdn.net/qq_26611129/article/details/116997082">https://blog.csdn.net/qq_26611129/article/details/116997082</a></p>
<p>纯 c++，使用 QTreeView</p>
<p><a href="https://www.cnblogs.com/wanghongyang/p/15017253.html">https://www.cnblogs.com/wanghongyang/p/15017253.html</a></p>
<h3 id="网络">网络</h3>
<p>http requst（纯 C++）</p>
<p>用信号、槽方式异步等待，建议需要搭配多线程使用</p>
<p><a href="https://download.csdn.net/download/one_l_star/10472150">https://download.csdn.net/download/one_l_star/10472150</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;QNetworkAccessManager&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QNetworkRequest&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QNetworkReply&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QUrl&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QEventLoop&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QNetworkAccessManager</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

<span class="n">QObject</span><span class="o">::</span><span class="n">connect</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">finished</span><span class="p">(</span><span class="n">QNetworkReply</span><span class="o">*</span><span class="p">)),</span> \
				<span class="k">this</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">onQNetworkReplyFinished</span><span class="p">(</span><span class="n">QNetworkReply</span><span class="o">*</span><span class="p">)));</span>
<span class="c1">// 要把 onQNetworkReplyFinished() 函数放入 public slots
</span><span class="c1"></span>
<span class="n">QNetworkReply</span> <span class="o">*</span><span class="n">reply</span> <span class="o">=</span> <span class="n">manager</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="n">QNetworkRequest</span><span class="p">(</span><span class="n">QUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)));</span>

<span class="kt">void</span> <span class="n">Translator_baidu</span><span class="o">::</span><span class="n">onQNetworkReplyFinished</span><span class="p">(</span><span class="n">QNetworkReply</span><span class="o">*</span> <span class="n">reply</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QString</span> <span class="n">response_json</span> <span class="o">=</span> <span class="n">reply</span><span class="o">-&gt;</span><span class="n">readAll</span><span class="p">();</span> <span class="c1">// json format
</span><span class="c1"></span>    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;response_json: &#34;</span> <span class="o">+</span> <span class="n">response_json</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>用事件循环方式 QEventLoop 同步等待，推荐</p>
<p><a href="https://blog.csdn.net/QtCompany/article/details/129282296">https://blog.csdn.net/QtCompany/article/details/129282296</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QNetworkAccessManager</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

<span class="n">QEventLoop</span> <span class="n">eventLoop</span><span class="p">;</span>

<span class="n">QNetworkReply</span> <span class="o">*</span><span class="n">reply</span> <span class="o">=</span> <span class="n">manager</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="n">QNetworkRequest</span><span class="p">(</span><span class="n">QUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)));</span>

<span class="c1">// 网络 http get 方法，同步方式
</span><span class="c1"></span><span class="n">connect</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">finished</span><span class="p">()),</span> <span class="o">&amp;</span><span class="n">eventLoop</span><span class="p">,</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">quit</span><span class="p">()));</span>
<span class="n">eventLoop</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>       <span class="c1">// block until finish
</span><span class="c1"></span>
<span class="c1">// 错误处理
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">reply</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QNetworkReply</span><span class="o">::</span><span class="n">NoError</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;err request protobufHttp&#34;</span><span class="p">;</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">;</span> <span class="k">return</span> <span class="n">dst</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 接收
</span><span class="c1"></span><span class="n">QByteArray</span> <span class="n">response_json</span> <span class="o">=</span> <span class="n">reply</span><span class="o">-&gt;</span><span class="n">readAll</span><span class="p">();</span> <span class="c1">// json format
</span><span class="c1"></span><span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;response_json: &#34;</span> <span class="o">+</span> <span class="n">response_json</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>用 while() 死等方式同步等待，不推荐</p>
<p><a href="https://blog.csdn.net/m0_73443478/article/details/130305415">https://blog.csdn.net/m0_73443478/article/details/130305415</a></p>
<h3 id="json-构造解析">Json 构造、解析</h3>
<p>（纯 C++，后面有 qml 的）</p>
<p>​	https://blog.csdn.net/weixin_46068274/article/details/127808897（例子）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;QJsonDocument&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QJsonParseError&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QJsonObject&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QJsonValue&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QJsonArray&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cm">/*
</span><span class="cm">    输出举例
</span><span class="cm">    正确回复：
</span><span class="cm">    {
</span><span class="cm">        &#34;from&#34;: &#34;en&#34;,
</span><span class="cm">        &#34;to&#34;: &#34;zh&#34;,
</span><span class="cm">        &#34;trans_result&#34;: [
</span><span class="cm">            {
</span><span class="cm">                &#34;src&#34;: &#34;apple&#34;,
</span><span class="cm">                &#34;dst&#34;: &#34;苹果&#34;
</span><span class="cm">            }
</span><span class="cm">        ]
</span><span class="cm">    }
</span><span class="cm">    异常回复：
</span><span class="cm">    {
</span><span class="cm">        &#34;error_code&#34;: &#34;54001&#34;,
</span><span class="cm">        &#34;error_msg&#34;: &#34;Invalid Sign&#34;
</span><span class="cm">    }
</span><span class="cm">*/</span>

<span class="c1">// 处理 json，提取 翻译结果
</span><span class="c1"></span><span class="n">QJsonParseError</span> <span class="n">jsonError</span><span class="p">;</span>
<span class="n">QJsonDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">QJsonDocument</span><span class="o">::</span><span class="n">fromJson</span><span class="p">(</span><span class="n">response_json</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">jsonError</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">jsonError</span><span class="p">.</span><span class="n">error</span> <span class="o">!=</span> <span class="n">QJsonParseError</span><span class="o">::</span><span class="n">NoError</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">doc</span><span class="p">.</span><span class="n">isNull</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;err Json Parse &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">jsonError</span><span class="p">.</span><span class="n">error</span><span class="p">;</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">;</span> <span class="k">return</span> <span class="n">dst</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QJsonObject</span> <span class="n">rootobj</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">object</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">rootobj</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;error_code&#34;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;err trans, error_msg: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">rootobj</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="s">&#34;error_msg&#34;</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">rootobj</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="s">&#34;error_msg&#34;</span><span class="p">).</span><span class="n">toString</span><span class="p">();</span> <span class="k">return</span> <span class="n">dst</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">QJsonArray</span>  <span class="n">trans_result</span> <span class="o">=</span> <span class="n">rootobj</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="s">&#34;trans_result&#34;</span><span class="p">).</span><span class="n">toArray</span><span class="p">();</span>
<span class="n">QJsonValue</span> <span class="n">dst_</span> <span class="o">=</span> <span class="n">trans_result</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">toObject</span><span class="p">().</span><span class="n">value</span><span class="p">(</span><span class="s">&#34;dst&#34;</span><span class="p">);</span>

<span class="n">dst</span> <span class="o">=</span> <span class="n">dst_</span><span class="p">.</span><span class="n">toString</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><p>​	https://blog.csdn.net/weixin_43729127/article/details/127522889（API 罗列）</p>
<p>​	https://blog.csdn.net/qq_44632658/article/details/127539003（API 罗列）</p>
<p>​	https://blog.csdn.net/My_class2233/article/details/125674115（API 罗列）</p>
<p>qt 里面，构造 json 可以用更方便的 QVariantMap</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;QVariantMap&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QJsonDocument&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;QJsonObject&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="n">QVariantMap</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">&#34;content&#34;</span><span class="p">,</span> <span class="mi">123</span><span class="p">},</span>
    <span class="p">{</span><span class="s">&#34;id&#34;</span><span class="p">,</span> <span class="s">&#34;abc&#34;</span><span class="p">},</span>
    <span class="p">...</span>
<span class="p">};</span>

<span class="n">QJsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">QVariant</span><span class="p">(</span><span class="n">params</span><span class="p">).</span><span class="n">toJsonObject</span><span class="p">();</span>
<span class="n">QByteArray</span> <span class="n">json_str</span> <span class="o">=</span> <span class="n">QJsonDocument</span><span class="p">(</span><span class="n">json</span><span class="p">).</span><span class="n">toJson</span><span class="p">(</span><span class="n">QJsonDocument</span><span class="o">::</span><span class="n">Compact</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>qml 里面解析 json</p>
<p>使用 JSON 对象，它包含两个函数，parse() 和 stringify()。</p>
<h3 id="颜色表示法">颜色表示法</h3>
<p>QML 颜色表示法</p>
<p>​	https://waleon.blog.csdn.net/article/details/129230582</p>
<h3 id="qt-定时器">qt 定时器</h3>
<p>继承自 QObjec 的类，QObject 还带有 timerEvent() 虚函数可以用，子类中实现该函数，再可以在构造函数里面 startTimer(xxx) 即可。</p>
<p><a href="https://www.ngui.cc/el/3202953.html?action=onClick">https://www.ngui.cc/el/3202953.html?action=onClick</a></p>
<p>qml 定时器</p>
<p><a href="https://waleon.blog.csdn.net/article/details/129340128">https://waleon.blog.csdn.net/article/details/129340128</a></p>
<h3 id="qt-测量时间">qt 测量时间</h3>
<p>提供了很多种方法 QTime、struct timeval &amp; gettimeofday()、clock() 等等。</p>
<p><a href="https://blog.csdn.net/hebbely/article/details/78953318">https://blog.csdn.net/hebbely/article/details/78953318</a></p>
<p>QElapsedTimer</p>
<p><a href="https://blog.csdn.net/lengyuezuixue/article/details/79996209">https://blog.csdn.net/lengyuezuixue/article/details/79996209</a></p>
<h3 id="单击显示坐标">单击显示坐标</h3>
<p>在 qml 的 root 控件 的 最后添加，且 其中设置 <code>mouse.accepted = false</code> 表示当前控件不接收 这个 事件，让其继续传递给其它控件，这样不会影响其它控件 相应 鼠标事件！<code>preventStealing: true</code> 和 <code>propagateComposedEvents: true</code> 同理。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">MouseArea</span> <span class="p">{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">findCurrentObj</span>
        <span class="nx">objectName</span><span class="o">:</span> <span class="s2">&#34;MouseArea_findCurrentObj&#34;</span>
        <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span>
        <span class="nx">preventStealing</span><span class="o">:</span> <span class="kc">true</span>
        <span class="nx">propagateComposedEvents</span><span class="o">:</span> <span class="kc">true</span>
        <span class="nx">onPressed</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">findPointObj</span><span class="p">(</span><span class="nx">mouseX</span><span class="p">,</span> <span class="nx">mouseY</span><span class="p">)</span>
            <span class="nx">mouse</span><span class="p">.</span><span class="nx">accepted</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="nx">onReleased</span><span class="o">:</span> <span class="p">{</span> <span class="nx">mouse</span><span class="p">.</span><span class="nx">accepted</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">}</span>
        <span class="nx">onClicked</span><span class="o">:</span>  <span class="p">{</span> <span class="nx">mouse</span><span class="p">.</span><span class="nx">accepted</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">property</span> <span class="kd">var</span> <span class="nx">obj</span><span class="o">:</span> <span class="nx">screen</span>

    <span class="kd">function</span> <span class="nx">findPointObj</span><span class="p">(</span><span class="nx">mouseX</span><span class="p">,</span> <span class="nx">mouseY</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34; —————————— pressed at:   &#34;</span> <span class="o">+</span> <span class="nx">mouseX</span> <span class="o">+</span> <span class="s2">&#34;   &#34;</span> <span class="o">+</span> <span class="nx">mouseY</span><span class="p">)</span>
        <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">screen</span><span class="p">.</span><span class="nx">childAt</span><span class="p">(</span><span class="nx">mouseX</span> <span class="p">,</span> <span class="nx">mouseY</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34; —————————— &#34;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">objectName</span><span class="p">)</span>

<span class="c1">//        console.log(point_.x, point_.y)
</span><span class="c1">//        console.log(childAt(point_.x, point_.y))
</span><span class="c1"></span>    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="多点触摸控件">多点触摸控件</h3>
<p>qml MultiPointTouchArea 控件</p>
<p><a href="https://blog.csdn.net/u014491932/article/details/124969522">https://blog.csdn.net/u014491932/article/details/124969522</a></p>
<p>c++ 中可以用 QTouchEvent，转换 event 为 QTouchEvent，再获取多点</p>
<h3 id="encodeuri">encodeURI()</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="s2">&#34;http://www.baidu.com/s?wd=KatieMelua&#34;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">encodedUri</span> <span class="o">=</span> <span class="nb">encodeURI</span> <span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">encodedComponent</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="nx">encodedUri</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encodedComponent</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">decodedUri</span> <span class="o">=</span> <span class="nb">decodeURI</span> <span class="p">(</span><span class="nx">encodedUri</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">decodedComponent</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">encodedComponent</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="nx">decodedUri</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">decodedComponent</span><span class="p">);</span>

<span class="cm">/*
</span><span class="cm">    encodeURI()方法用于处理完整的URI(例如http://www.pingwvest.com/abc def.html),而
</span><span class="cm">    encodeURIComponent()用于处理URI的一个片段(如 abc def.html)。两者的主要区别是,
</span><span class="cm">    encodeURI()方法不对URI中的特殊字符进行编码,如冒号、前斜杠、问号等;而
</span><span class="cm">    encodeURIComponent()则对它发现的所有非标准字符进行编码。通常我们使用encodeURI()
</span><span class="cm">    处理完整的URI,使用encodeURIComponent()处理附加在已有UR1末尾的字符串
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="控件对应-c-原型">控件对应 C++ 原型</h3>
<p>打印 qml 里面控件的 id，会打印该控件对应的 C++ 的类的名字，在 qt 源码中可以找到 该控件的 C++ 实现，里面有对应的 属性、信号 等的定义~。若含有 QMLTYPE 字样，则该控件是 qml 中定义的控件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">Component</span><span class="p">.</span><span class="nx">on</span> <span class="nx">Completed</span><span class="o">:</span><span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;QML Text\&#39;s C++ type - &#34;</span><span class="p">,</span> <span class="nx">text1</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;QML Button\&#39;s C++ type - &#34;</span><span class="p">,</span><span class="nx">buttonl</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;QML Image\&#39;s C++ type - &#34;</span><span class="p">,</span> <span class="nx">imagel</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="键盘事件">键盘事件</h3>
<p>QML 键盘事件</p>
<p>​	https://waleon.blog.csdn.net/article/details/129309600</p>
<h3 id="快捷键">快捷键</h3>
<p>QML 快捷键（Shortcut、Keys）
<a href="https://blog.csdn.net/gongjianbo1992/article/details/116954979">https://blog.csdn.net/gongjianbo1992/article/details/116954979</a></p>
<h3 id="输入组件--文本块显示">输入组件 / 文本块显示</h3>
<blockquote>
<p>行编辑 Textlnput 与 TextField</p>
<p>文本块 TextEdit 与 TextArea</p>
</blockquote>
<p>TextEdit 是 Textlnput 的升级，TextArea 是 TextField的升级。TextEdit 与 TextArea 具有 指定文本格式、内容的语法高亮、如何折行、提供 API 编辑其内容，背景可以更改 等等。</p>
<blockquote>
<p>TextEdit可定制cursor，与TextInput类似，TextEdit也有cursorDelegate属性，TextArea 没有。
TextArea支持文本滚动，这是TextArea的大招啊，你什么都不用做，它就可以支持上下方向键(非只读模式)、翻页键以及鼠标中键的滚动，因为它继承自ScrollView。</p>
</blockquote>
<p>QML 基本文本输入组件TextInput、TextField、TextEdit、TextArea
<a href="https://blog.csdn.net/gongjianbo1992/article/details/101156110">https://blog.csdn.net/gongjianbo1992/article/details/101156110</a></p>
<p>Qml 输入框 的 validator 属性
<a href="https://www.rstk.cn/news/722557.html?action=onClick">https://www.rstk.cn/news/722557.html?action=onClick</a>
其中 RegExpValidator 字符串验证用 JavaScript 正则表达式写： <a href="https://www.runoob.com/jsref/jsref-obj-regexp.html">https://www.runoob.com/jsref/jsref-obj-regexp.html</a>
QML设置IP输入验证 <a href="https://blog.csdn.net/joyopirate/article/details/110167359">https://blog.csdn.net/joyopirate/article/details/110167359</a></p>
<h3 id="虚拟键盘">虚拟键盘</h3>
<p>​	https://www.cnblogs.com/linuxAndMcu/p/13667894.html</p>
<h3 id="读-excel-表格">读 Excel 表格</h3>
<p>（纯 C++，使用 QAxObject 类）</p>
<p>​	https://blog.csdn.net/didi_ya/article/details/120208099（基础 API 介绍）</p>
<h3 id="调用-sqlite">调用 SQLite</h3>
<p>QML 保存用户配置，调用 SQLite
<a href="https://waleon.blog.csdn.net/article/details/132073943">https://waleon.blog.csdn.net/article/details/132073943</a></p>
<h3 id="动画">动画</h3>
<p>Qml 动画</p>
<p>​	https://blog.csdn.net/Mr_robot_strange/article/details/126522600
​	https://zhuanlan.zhihu.com/p/564072781
​	https://blog.csdn.net/wenxingchen/article/details/128522558</p>
<p>点击后移动效果，比如输入框点击之后 动画移动 x,y 到屏幕中上方（也可以再加个背景框和文字标题），以避免弹出虚拟键盘后遮挡原来位置的输入框。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">        <span class="nx">onPressed</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">isInputting</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">z</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="c1">// 点击后输入框飞到屏幕中上，键盘不会遮挡
</span><span class="c1"></span>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isTextFieldAnimationMove</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">x</span> <span class="o">=</span> <span class="mi">280</span>
                <span class="nx">y</span> <span class="o">=</span> <span class="mi">70</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="nx">animation_x_go_textField_Domain_name</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span>
                <span class="nx">animation_y_go_textField_Domain_name</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">onEditingFinished</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">isInputting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="nx">z</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="nx">ca_certiInputModel</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="nx">text</span><span class="o">:</span> <span class="nx">textField_Domain_name</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">toString</span><span class="p">()});</span>
            <span class="c1">// 输入完成后回到原位
</span><span class="c1"></span>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isTextFieldAnimationMove</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">x</span> <span class="o">=</span> <span class="mi">629</span>
                <span class="nx">y</span> <span class="o">=</span> <span class="mi">172</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="nx">animation_x_back_textField_Domain_name</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span>
                <span class="nx">animation_y_back_textField_Domain_name</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">PropertyAnimation</span> <span class="nx">on</span> <span class="nx">x</span> <span class="p">{</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Easing</span><span class="p">.</span><span class="nx">OutQuad</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">animation_x_go_textField_Domain_name</span><span class="p">;</span> <span class="nx">to</span><span class="o">:</span> <span class="mi">280</span>
            <span class="nx">duration</span><span class="o">:</span> <span class="mi">300</span><span class="p">;</span> <span class="nx">running</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}</span>
        <span class="nx">PropertyAnimation</span> <span class="nx">on</span> <span class="nx">y</span> <span class="p">{</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Easing</span><span class="p">.</span><span class="nx">OutQuad</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">animation_y_go_textField_Domain_name</span><span class="p">;</span> <span class="nx">to</span><span class="o">:</span> <span class="mi">70</span>
            <span class="nx">duration</span><span class="o">:</span> <span class="mi">300</span><span class="p">;</span> <span class="nx">running</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}</span>

        <span class="nx">PropertyAnimation</span> <span class="nx">on</span> <span class="nx">x</span> <span class="p">{</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Easing</span><span class="p">.</span><span class="nx">OutQuad</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">animation_x_back_textField_Domain_name</span><span class="p">;</span> <span class="nx">to</span><span class="o">:</span> <span class="mi">629</span>
            <span class="nx">duration</span><span class="o">:</span> <span class="mi">300</span><span class="p">;</span> <span class="nx">running</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}</span>
        <span class="nx">PropertyAnimation</span> <span class="nx">on</span> <span class="nx">y</span> <span class="p">{</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Easing</span><span class="p">.</span><span class="nx">OutQuad</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">animation_y_back_textField_Domain_name</span><span class="p">;</span> <span class="nx">to</span><span class="o">:</span> <span class="mi">172</span>
            <span class="nx">duration</span><span class="o">:</span> <span class="mi">300</span><span class="p">;</span> <span class="nx">running</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="绘图">绘图</h3>
<p>绘图 Shapes Canvas</p>
<p>​	https://blog.csdn.net/qq_21438461/article/details/130464717</p>
<p>​	Shapes：https://blog.csdn.net/xiaoyu21520/article/details/130890829</p>
<p>​	Canvas：https://waleon.blog.csdn.net/article/details/131254637</p>
<h3 id="显示网页">显示网页</h3>
<p>Qml 显示网页</p>
<p>​	WebEngineView</p>
<p>​		说明：QtWebEngine  使用了使用 LGPLv2.1 协议的 的三方组件，且只能用 MSVC 编译</p>
<p>​		https://zhuanlan.zhihu.com/p/623440635	看这个就可以跑起来了</p>
<p>​		https://zhuanlan.zhihu.com/p/616392695</p>
<p>​		https://www.cnblogs.com/judes/p/15641582.html</p>
<p>​		http://www.xn.bslzg.com/userblog/onenews.aspx?blog_news_nodeuuid=16483762468210000003000</p>
<p>​		https://blog.csdn.net/u013352076/article/details/121016093</p>
<p>​	WebView</p>
<p>​		https://www.elecfans.com/d/2088103.html</p>
<p>​		https://doc.qt.io/qt-5/qml-qtwebview-webview.html#details</p>
<h3 id="程序打包">程序打包</h3>
<p>Qt release 程序打包（注意，使用 <code>windeployqt</code> 对 qml 工程打包，应该再加上 <code>--qmldir &lt;qml源码地址&gt;</code>）</p>
<p>​	https://blog.csdn.net/zlpng/article/details/130773437</p>
<p>​	https://blog.csdn.net/weixin_68016945/article/details/130493586</p>
<p>​	程序 放到另一个电脑上出问题： <a href="https://blog.csdn.net/childbor/article/details/125283893">https://blog.csdn.net/childbor/article/details/125283893</a></p>
<p>​	程序文件夹瘦身：</p>
<p>​		https://www.ycpai.cn/python/Mwbdzv3Q.html</p>
<p>​		https://blog.csdn.net/weixin_42126427/article/details/113250855</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2025-02-10</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://staok.github.io/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/" data-title="QT &amp; QML 总结备查" data-hashtags="QT,GUI"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://staok.github.io/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/" data-hashtag="QT"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Linkedin" data-sharer="linkedin" data-url="https://staok.github.io/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://staok.github.io/34qt-qml-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/" data-title="QT &amp; QML 总结备查" data-ralateuid="u/3585238893"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/qt/">QT</a>,&nbsp;<a href="/tags/gui/">GUI</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/35lvgl-%E6%80%BB%E7%BB%93%E5%A4%87%E6%9F%A5/" class="prev" rel="prev" title="LVGL 总结备查"><i class="fas fa-angle-left fa-fw"></i>LVGL 总结备查</a>
            <a href="/33tia%E5%BC%B1%E7%94%B5%E6%B5%81%E6%B5%8B%E9%87%8F%E6%8E%AA%E6%96%BD%E5%92%8C%E7%BB%8F%E9%AA%8C%E6%B1%87%E6%80%BB/" class="next" rel="next" title="TIA 弱电流测量措施和经验汇总">TIA 弱电流测量措施和经验汇总<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.84.4">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2026</span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{},"data":{"id-1":"回家","id-2":"回家"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
